<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Skin Lesion Classification Task – skin_cancer_model_ISIC2016</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Skin Lesion Classification Task – skin_cancer_model_ISIC2016">
<meta property="og:site_name" content="skin_cancer_model_ISIC2016">
<meta name="twitter:title" content="Skin Lesion Classification Task – skin_cancer_model_ISIC2016">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">skin_cancer_model_ISIC2016</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html">Skin Lesion Classification Task</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Skin Lesion Classification Task</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fevzi KILAS</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#giris" id="toc-giris" class="nav-link" data-scroll-target="#giris">Giris</a></li>
  <li><a href="#step1-transfer-learning-approach" id="toc-step1-transfer-learning-approach" class="nav-link" data-scroll-target="#step1-transfer-learning-approach">Step1: Transfer Learning Approach</a></li>
  <li><a href="#adım-1-transfer-öğrenme-yaklaşımı" id="toc-adım-1-transfer-öğrenme-yaklaşımı" class="nav-link" data-scroll-target="#adım-1-transfer-öğrenme-yaklaşımı">Adım 1: Transfer Öğrenme Yaklaşımı</a></li>
  <li><a href="#step2-building-an-image-classification-model-from-scratch" id="toc-step2-building-an-image-classification-model-from-scratch" class="nav-link" data-scroll-target="#step2-building-an-image-classification-model-from-scratch">Step2: Building an Image Classification Model From Scratch</a></li>
  <li><a href="#adım-2-sıfırdan-bir-görüntü-sınıflandırma-modeli-oluşturma" id="toc-adım-2-sıfırdan-bir-görüntü-sınıflandırma-modeli-oluşturma" class="nav-link" data-scroll-target="#adım-2-sıfırdan-bir-görüntü-sınıflandırma-modeli-oluşturma">Adım 2: Sıfırdan Bir Görüntü Sınıflandırma Modeli Oluşturma</a></li>
  <li><a href="#visualization-and-evaluation-of-models" id="toc-visualization-and-evaluation-of-models" class="nav-link" data-scroll-target="#visualization-and-evaluation-of-models">Visualization and Evaluation of Models</a>
  <ul class="collapse">
  <li><a href="#modellerin-görselleştirilmesi-ve-değerlendirilmesi" id="toc-modellerin-görselleştirilmesi-ve-değerlendirilmesi" class="nav-link" data-scroll-target="#modellerin-görselleştirilmesi-ve-değerlendirilmesi">Modellerin Görselleştirilmesi ve Değerlendirilmesi</a></li>
  </ul></li>
  <li><a href="#report" id="toc-report" class="nav-link" data-scroll-target="#report">Report</a>
  <ul class="collapse">
  <li><a href="#rapor" id="toc-rapor" class="nav-link" data-scroll-target="#rapor">Rapor</a></li>
  </ul></li>
  <li><a href="#transfer-learning-approach" id="toc-transfer-learning-approach" class="nav-link" data-scroll-target="#transfer-learning-approach">1- Transfer learning approach:</a></li>
  <li><a href="#model-1-with-frozen-layers" id="toc-model-1-with-frozen-layers" class="nav-link" data-scroll-target="#model-1-with-frozen-layers">1.1- Model 1: with frozen layers</a></li>
  <li><a href="#model-2-with-reduced-architecture" id="toc-model-2-with-reduced-architecture" class="nav-link" data-scroll-target="#model-2-with-reduced-architecture">1.2- Model 2: with reduced architecture</a></li>
  <li><a href="#model-3-with-partially-open-layers" id="toc-model-3-with-partially-open-layers" class="nav-link" data-scroll-target="#model-3-with-partially-open-layers">1.3- Model 3: with partially open layers</a></li>
  <li><a href="#results-of-models" id="toc-results-of-models" class="nav-link" data-scroll-target="#results-of-models">1.4- Results of Models</a>
  <ul class="collapse">
  <li><a href="#corect-train---which-means-the-latest-version-of-the-models-result--" id="toc-corect-train---which-means-the-latest-version-of-the-models-result--" class="nav-link" data-scroll-target="#corect-train---which-means-the-latest-version-of-the-models-result--">Corect Train - which means the latest version of the models result -</a></li>
  <li><a href="#the-previous-model-from-the-models-that-i-trained-correctly-last----" id="toc-the-previous-model-from-the-models-that-i-trained-correctly-last----" class="nav-link" data-scroll-target="#the-previous-model-from-the-models-that-i-trained-correctly-last----">- - ^^ THE PREVİOUS MODEL FROM THE MODELS THAT I TRAINED CORRECTLY LAST ^^- -</a></li>
  <li><a href="#model-1-loss-curves" id="toc-model-1-loss-curves" class="nav-link" data-scroll-target="#model-1-loss-curves">Model 1 loss curves</a></li>
  <li><a href="#model-2-loss-curves" id="toc-model-2-loss-curves" class="nav-link" data-scroll-target="#model-2-loss-curves">Model 2 loss curves</a></li>
  <li><a href="#model-3-loss-curves" id="toc-model-3-loss-curves" class="nav-link" data-scroll-target="#model-3-loss-curves">Model 3 loss curves</a></li>
  </ul></li>
  <li><a href="#reporting-of-step-1-transfer-learning-approach" id="toc-reporting-of-step-1-transfer-learning-approach" class="nav-link" data-scroll-target="#reporting-of-step-1-transfer-learning-approach">1.5- Reporting of Step 1: Transfer Learning Approach</a>
  <ul class="collapse">
  <li><a href="#confusion-matrix-classification-report-precision-recall-f1-score-and-support" id="toc-confusion-matrix-classification-report-precision-recall-f1-score-and-support" class="nav-link" data-scroll-target="#confusion-matrix-classification-report-precision-recall-f1-score-and-support">1.5.1- Confusion matrix, Classification Report: precision, recall, f1-score, and support</a>
  <ul class="collapse">
  <li><a href="#confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-1" id="toc-confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-1" class="nav-link" data-scroll-target="#confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-1">1.5.1.1- Confusion matrix, Classification Report: precision, recall, f1-score, and support of the model 1</a></li>
  <li><a href="#confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-2" id="toc-confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-2" class="nav-link" data-scroll-target="#confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-2">1.5.1.2- Confusion matrix, Classification Report: precision, recall, f1-score, and support of the model 2</a></li>
  <li><a href="#confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-3" id="toc-confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-3" class="nav-link" data-scroll-target="#confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-3">1.5.1.3- Confusion matrix, Classification Report: precision, recall, f1-score, and support of the model 3</a></li>
  </ul></li>
  <li><a href="#example-of-correctly-classified-samples-and-incorrectly-classified-samples" id="toc-example-of-correctly-classified-samples-and-incorrectly-classified-samples" class="nav-link" data-scroll-target="#example-of-correctly-classified-samples-and-incorrectly-classified-samples">1.5.2- Example of Correctly Classified Samples and Incorrectly Classified Samples</a></li>
  </ul></li>
  <li><a href="#step2-building-an-image-classification-model-from-scratch-1" id="toc-step2-building-an-image-classification-model-from-scratch-1" class="nav-link" data-scroll-target="#step2-building-an-image-classification-model-from-scratch-1">Step2: Building an Image Classification Model From Scratch</a>
  <ul class="collapse">
  <li><a href="#i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence." id="toc-i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence." class="nav-link" data-scroll-target="#i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence.">I thought the model did not prerdict any 1 but when I look at a few more pictures and than I see it. It was just a coincidence.</a></li>
  <li><a href="#loss-curve-of-cnn-model." id="toc-loss-curve-of-cnn-model." class="nav-link" data-scroll-target="#loss-curve-of-cnn-model.">Loss curve of CNN model.</a></li>
  <li><a href="#confusion-matrix-and-classification-report-of-cnn-model" id="toc-confusion-matrix-and-classification-report-of-cnn-model" class="nav-link" data-scroll-target="#confusion-matrix-and-classification-report-of-cnn-model">Confusion matrix and Classification Report of CNN Model</a></li>
  <li><a href="#i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence.-and-also-i-look-to-the-confusion-matrix-and-it-shows-us-69-6-predictions-results-are-1." id="toc-i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence.-and-also-i-look-to-the-confusion-matrix-and-it-shows-us-69-6-predictions-results-are-1." class="nav-link" data-scroll-target="#i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence.-and-also-i-look-to-the-confusion-matrix-and-it-shows-us-69-6-predictions-results-are-1.">^^ ^^ I thought the model did not prerdict any 1 but when I look at a few more pictures and than I see it. It was just a coincidence. And also I look to the confusion matrix and it shows us 69 + 6 predictions results are 1.</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/fevzikilas/skin_cancer_model_ISIC2016/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Skin Lesion Classification Task</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<section id="en" class="level4">
<h4 class="anchored" data-anchor-id="en">[EN]</h4>
<p>In this assignment, I was tasked with utilizing the PyTorch libraries to train and evaluate a set of deep learning models. The assignment revolved around two distinct approaches:</p>
<p>Transfer learning approach: In this approach, I leveraged pre-trained models as a starting point. Transfer learning involves utilizing the knowledge gained from training on a large dataset (typically ImageNet) and applying it to a different but related task, such as classifying skin lesions. By building upon the pre-trained models, I aimed to benefit from their learned features and adapt them to improve the performance of my skin lesion classifier.</p>
<p>Building a classifier model from scratch: In addition to the transfer learning approach, I was required to implement my own classifier model from scratch. This involved designing and training a deep learning model specifically tailored for classifying skin lesions. I had the freedom to experiment with different architectures, layers, and optimization techniques to create an effective and accurate classifier.</p>
<p>Both approaches provided valuable insights into the field of deep learning and allowed me to explore different strategies for developing a skin lesion classifier.</p>
</section>
</section>
<section id="giris" class="level3">
<h3 class="anchored" data-anchor-id="giris">Giris</h3>
<section id="tr" class="level4">
<h4 class="anchored" data-anchor-id="tr">[TR]</h4>
<p>Bu ödevde PyTorch kütüphanelerini kullanarak bir dizi derin öğrenme modeli eğitmem ve değerlendirmem gerekti. Ödev, iki farklı yaklaşımı içeriyor:</p>
<p>Transfer öğrenme yaklaşımı: Bu yaklaşımda önceden eğitilmiş modelleri başlangıç noktası olarak kullanıyorum. Transfer öğrenme, büyük bir veri seti (genellikle ImageNet) üzerinde eğitilen bir modelin bilgisini, farklı ancak ilgili bir görev için (örneğin, cilt lezyonlarını sınıflandırma) uygulamayı içerir. Önceden eğitilmiş modellerin öğrendiği özelliklerden faydalanarak, cilt lezyonu sınıflandırıcısının performansını artırmayı hedefledim.</p>
<p>Sıfırdan bir sınıflandırıcı modeli oluşturma: Transfer öğrenme yaklaşımına ek olarak, sıfırdan kendi sınıflandırıcı modelimi oluşturmam istendi. Bu, cilt lezyonlarını sınıflandırmaya yönelik özel bir derin öğrenme modeli tasarlamak ve eğitmek anlamına geliyor. Farklı mimariler, katmanlar ve optimizasyon tekniklerini deneyerek etkili ve doğru bir sınıflandırıcı oluşturmakta özgürdüm.</p>
<p>Her iki yaklaşım da derin öğrenme alanında değerli bilgiler sunarak, cilt lezyonu sınıflandırıcısı geliştirmek için farklı stratejileri keşfetmeme olanak sağladı.</p>
</section>
</section>
<section id="step1-transfer-learning-approach" class="level3">
<h3 class="anchored" data-anchor-id="step1-transfer-learning-approach">Step1: Transfer Learning Approach</h3>
<section id="en-1" class="level4">
<h4 class="anchored" data-anchor-id="en-1">[EN]</h4>
<p>In this step, I utilized the ResNet50 model, which has been pretrained on the ImageNet dataset. You can access the pretrained model weights <a href="https://pytorch.org/vision/stable/models.html">3</a>here. For this task, I trained three different models using the following fine-tuning strategies:</p>
<p>Model-1: With Frozen Layers: In this approach, I kept the pretrained layers of the ResNet50 model fixed and only trained the classifier layer. By freezing the other layers, I leveraged the learned features of the pretrained model while focusing on adapting the classifier to the specific task of skin lesion classification.</p>
<p>Model-2: With Partially Open Layers: In this model, I selectively opened and fine-tuned the last half of the ResNet50 model while also training the classifier layer. By unfreezing and fine-tuning these layers, I allowed the model to adjust and improve its performance based on the target task.</p>
<p>Model-3: With Reduced Architecture: In this approach, I added a classifier layer at the end of the first half of the ResNet50 model. By removing the second half of the pretrained model, I effectively reduced the model to half its original size. In this case, the first half of this modified model remained frozen, while the second half was fine-tuned during training. This allowed the model to focus on learning representations specific to skin lesion classification within the constrained architecture.</p>
<p>By applying these three strategies, I explored different ways to utilize the ResNet50 model for skin lesion classification and evaluated the effectiveness of these approaches in achieving accurate and robust results.</p>
</section>
</section>
<section id="adım-1-transfer-öğrenme-yaklaşımı" class="level3">
<h3 class="anchored" data-anchor-id="adım-1-transfer-öğrenme-yaklaşımı">Adım 1: Transfer Öğrenme Yaklaşımı</h3>
<section id="tr-1" class="level4">
<h4 class="anchored" data-anchor-id="tr-1">[TR]</h4>
<p>Bu adımda, ImageNet veri seti üzerinde önceden eğitilmiş olan ResNet50 modelini kullandım. Önceden eğitilmiş modelin ağırlıklarına buradan erişebilirsiniz. Bu görev için üç farklı model eğittim ve her bir modelde şu stratejileri kullandım:</p>
<p>Model-1: Donmuş Katmanlarla: Bu yaklaşımda, ResNet50 modelinin önceden eğitilmiş katmanlarını sabit tutarak yalnızca sınıflandırıcı katmanını eğittim. Diğer katmanları dondurarak, önceden eğitilmiş modelin öğrendiği özelliklerden yararlandım ve sınıflandırıcıyı cilt lezyonu sınıflandırma görevine uyarlamaya odaklandım.</p>
<p>Model-2: Kısmen Açık Katmanlarla: Bu modelde, ResNet50 modelinin son yarısını açarak ince ayar yaptım ve aynı zamanda sınıflandırıcı katmanını da eğittim. Bu katmanları seçerek açıp ince ayar yaparak, modelin hedef göreve dayalı performansını iyileştirmesini sağladım.</p>
<p>Model-3: Azaltılmış Mimari ile: Bu yaklaşımda, ResNet50 modelinin ilk yarısının sonuna bir sınıflandırıcı katman ekledim. Modelin ikinci yarısını kaldırarak, mimariyi orijinal boyutunun yarısına indirdim. Bu durumda, modifiye edilen modelin ilk yarısı donmuş olarak kaldı, ikinci yarısı ise eğitim sırasında ince ayarlandı. Bu yaklaşım, sınırlı bir mimari içinde cilt lezyonu sınıflandırmaya özgü temsil öğrenimine odaklanmasını sağladı.</p>
<p>Bu üç stratejiyi uygulayarak, ResNet50 modelini cilt lezyonu sınıflandırması için farklı yollarla kullandım ve bu yaklaşımların doğru ve güçlü sonuçlar elde etmedeki etkinliğini değerlendirdim.</p>
</section>
</section>
<section id="step2-building-an-image-classification-model-from-scratch" class="level3">
<h3 class="anchored" data-anchor-id="step2-building-an-image-classification-model-from-scratch">Step2: Building an Image Classification Model From Scratch</h3>
<section id="en-2" class="level4">
<h4 class="anchored" data-anchor-id="en-2">[EN]</h4>
<p>Step 2: Building an Image Classification Model From Scratch In this step, I created an image classification model from scratch without utilizing pre-trained weights. I designed a convolutional neural network (CNN) architecture specifically tailored for the task of skin lesion classification. I used the PyTorch libraries for image preprocessing tasks such as standardizing images and applying data augmentation techniques.</p>
<p>For image preprocessing, I took advantage of PyTorch’s functions to perform tasks like image normalization, resizing, and data augmentation techniques such as random cropping, flipping, and rotation. These preprocessing steps were crucial for enhancing the model’s ability to learn discriminative features from skin lesion images.</p>
<p>When designing my CNN architecture, I experimented with various configurations of convolutional layers, pooling layers, and fully connected layers. I adjusted the number of layers, filter sizes, and the number of neurons in the fully connected layers to optimize the model’s performance. By building the model from scratch, I had the opportunity to explore and implement innovative architectural choices and evaluate their impact on the task of skin lesion classification.</p>
</section>
</section>
<section id="adım-2-sıfırdan-bir-görüntü-sınıflandırma-modeli-oluşturma" class="level3">
<h3 class="anchored" data-anchor-id="adım-2-sıfırdan-bir-görüntü-sınıflandırma-modeli-oluşturma">Adım 2: Sıfırdan Bir Görüntü Sınıflandırma Modeli Oluşturma</h3>
<section id="tr-2" class="level4">
<h4 class="anchored" data-anchor-id="tr-2">[TR]</h4>
<p>Bu adımda, önceden eğitilmiş ağırlıklar kullanmadan sıfırdan bir görüntü sınıflandırma modeli oluşturdum. Cilt lezyonu sınıflandırma görevine özgü olarak tasarlanmış bir konvolüsyonel sinir ağı (CNN) mimarisi oluşturdum. Görüntü ön işleme adımları için PyTorch kütüphanelerini kullandım. Bu adımlar, görüntülerin normalize edilmesi ve veri çoğaltma (data augmentation) tekniklerini içerdi.</p>
<p>Görüntü ön işleme için, PyTorch’un sağladığı işlevler sayesinde görüntüleri normalleştirme, yeniden boyutlandırma ve rastgele kırpma, çevirme, döndürme gibi veri çoğaltma tekniklerini uyguladım. Bu adımlar, modelin cilt lezyonu görüntülerinden ayırt edici özellikler öğrenme yeteneğini artırmak için oldukça önemliydi.</p>
<p>CNN mimarimi tasarlarken, konvolüsyonel katmanlar, havuzlama katmanları (pooling layers) ve tam bağlı katmanlar (fully connected layers) gibi farklı katman yapılarını denedim. Katman sayısı, filtre boyutları ve tam bağlı katmanlardaki nöron sayısını ayarlayarak modelin performansını optimize etmeye çalıştım. Sıfırdan bir model oluşturarak, yenilikçi mimari tercihleri keşfetme ve bunların cilt lezyonu sınıflandırma görevine etkisini değerlendirme fırsatım oldu.</p>
</section>
</section>
<section id="visualization-and-evaluation-of-models" class="level2">
<h2 class="anchored" data-anchor-id="visualization-and-evaluation-of-models">Visualization and Evaluation of Models</h2>
<section id="en-3" class="level4">
<h4 class="anchored" data-anchor-id="en-3">[EN]</h4>
<p>After completing the model training, I visually analyzed and evaluated the performance of the trained models. These observations were included in my report. The following components were expected:</p>
<p>Visualizations:</p>
<p>Loss Graph: Displayed the training and validation loss curves for each model. These graphs provided insights into the training progress and how close the models were to convergence over the epochs.</p>
<p>Confusion Matrix: Presented a confusion matrix for each model, illustrating the classification performance across different skin lesion categories. This visual assessment helped in understanding the model’s ability to correctly predict and distinguish between different classes.</p>
<p>Sample Images: I included a selection of test set samples. For each model, I showcased five correctly classified test samples and five incorrectly classified test samples. This visual representation provided an intuitive understanding of the model’s strengths and weaknesses.</p>
<p>Evaluation:</p>
<p>Comparison of Results: I compared and analyzed the performance of the transfer learning models and the model trained from scratch. To assess the effectiveness of these models in multi-category classification, I used metrics such as accuracy, precision, recall, and F1-score. These metrics were summarized and compared in a table, providing a concise overview and allowing for easy comparison and analysis. By examining the loss curves, confusion matrices, and sample images, I gained insights into the learning patterns, class separability, and error tendencies of the models. Additionally, the evaluation of accuracy metrics and the comparison table provided a quantitative assessment of the models’ classification capabilities. This comprehensive evaluation helped me analyze the strengths and weaknesses of different approaches and compare their effectiveness in skin lesion classification.</p>
</section>
<section id="modellerin-görselleştirilmesi-ve-değerlendirilmesi" class="level3">
<h3 class="anchored" data-anchor-id="modellerin-görselleştirilmesi-ve-değerlendirilmesi">Modellerin Görselleştirilmesi ve Değerlendirilmesi</h3>
<section id="tr-3" class="level4">
<h4 class="anchored" data-anchor-id="tr-3">[TR]</h4>
<p>Model eğitimlerini tamamladıktan sonra, eğitilen modellerin performanslarını görsel olarak analiz ettim ve değerlendirdim. Raporumda bu gözlemler yer aldı. Beklenen bileşenler aşağıdaki gibidir:</p>
<p>Görselleştirmeler:</p>
<p>Kayıp Grafiği (Loss Graph): Her bir model için eğitim ve doğrulama kayıplarını gösteren grafikler oluşturuldu. Bu grafikler, modellerin eğitim sürecindeki ilerlemelerini ve her epoch boyunca ne kadar yaklaştıklarını göstermesi açısından önemliydi.</p>
<p>Karışıklık Matrisi (Confusion Matrix): Her modelin sınıflandırma performansını gösteren karışıklık matrisi sunuldu. Bu matris, modellerin farklı cilt lezyonu kategorilerini ne derece doğru sınıflandırabildiğini görsel olarak değerlendirmeye olanak tanıdı.</p>
<p>Örnek Görseller: Test setinden alınan örnek görüntüler sunuldu. Her model için doğru sınıflandırılmış beş test örneği ve yanlış sınıflandırılmış beş test örneği gösterildi. Bu görsel temsil, modellerin güçlü ve zayıf yönlerini vurgulamak için önemli bir sezgisel anlayış sağladı.</p>
<p>Değerlendirme:</p>
<p>Sonuçların Karşılaştırılması: Transfer öğrenme modelleri ile sıfırdan eğitilen modelin performansını karşılaştırdım ve analiz ettim. Çok kategorili sınıflandırma görevinde modellerin etkinliğini değerlendirmek için doğruluk (accuracy), kesinlik (precision), geri çağırma (recall), ve F1 skoru gibi metrikleri kullandım. Bu metrikler, modellerin performansını özetleyen ve karşılaştırmalı analiz için kolaylık sağlayan bir tablo halinde sunuldu. Kayıp eğrilerini, karışıklık matrislerini ve örnek görüntüleri görsel olarak inceleyerek, modellerin öğrenme eğilimlerini, sınıf ayrışabilirliğini ve hata yapma eğilimlerini gözlemleyebildim. Ayrıca, doğruluk metrikleri ve performans karşılaştırma tablosu, modellerin sınıflandırma yeteneklerine dair nicel bir değerlendirme sundu. Bu kapsamlı değerlendirme, farklı yaklaşımların güçlü ve zayıf yönlerini analiz etmeme ve cilt lezyonu sınıflandırmasındaki etkinliklerini karşılaştırmama yardımcı oldu.</p>
</section>
</section>
</section>
<section id="report" class="level2">
<h2 class="anchored" data-anchor-id="report">Report</h2>
<section id="en-4" class="level4">
<h4 class="anchored" data-anchor-id="en-4">[EN]</h4>
<ul>
<li>Custom Design CNN Model: In this report, I provided a detailed description of the convolutional neural network (CNN) model I built from scratch. I explained each layer in the model, its configurations, and the specific design choices I made. Additionally, I included a block diagram to visually illustrate the data flow and the connections between different layers within the model. This diagram provided a clearer understanding of the overall architecture.</li>
</ul>
<p>While designing the CNN, I experimented with various configurations of convolutional layers, pooling layers, and fully connected layers. By adjusting parameters like the number of layers, filter sizes, and the number of neurons in fully connected layers, I aimed to optimize the model’s performance. Image preprocessing steps such as data augmentation and normalization also played a key role in improving the model’s effectiveness.</p>
<ul>
<li>Test Results &amp; Visualizations: In this section, I presented the test results for both the transfer learning models and the model I built from scratch. This section included:</li>
</ul>
<p>Loss Graphs: I displayed graphs showing the changes in training and validation losses over time, which helped evaluate the progress and convergence of each model during training. Confusion Matrices: I presented confusion matrices for each model to analyze their ability to correctly classify different categories of skin lesions. Sample Images: I included examples from the test set that were both correctly and incorrectly classified, which provided visual insights into the models’ strengths and weaknesses. Performance Comparison Table: I created a table comparing the accuracy, precision, recall, and F1-scores of all the models, enabling a clear comparison of their results.</p>
<ul>
<li>Conclusion and Future Work: I summarized the key findings and conclusions from my experiments. I observed that transfer learning methods, especially with pre-trained models, tend to outperform custom-built models in terms of both speed and accuracy, particularly when working with limited datasets. However, building a model from scratch offered more control over the architecture and allowed for creative solutions specific to the task.</li>
</ul>
<p>For future work, I plan to experiment with larger datasets and deeper, more complex architectures to further enhance model performance. Additionally, extending the classification to more detailed categories of skin lesions and adding more classes could be an interesting direction for future research.</p>
</section>
<section id="rapor" class="level3">
<h3 class="anchored" data-anchor-id="rapor">Rapor</h3>
<section id="tr-4" class="level4">
<h4 class="anchored" data-anchor-id="tr-4">[TR]</h4>
<ul>
<li>Özel Tasarım CNN Modeli: Bu raporda, sıfırdan oluşturduğum konvolüsyonel sinir ağı (CNN) modelimin mimarisini detaylı bir şekilde açıkladım. Modelde yer alan her bir katmanı, katmanların yapılandırmalarını ve yaptığım tasarım tercihlerini ayrıntılı olarak belirttim. Ayrıca, modelin katmanlar arasındaki veri akışını ve katmanlar arası bağlantıları görsel olarak gösteren bir blok diyagramı sundum. Bu diyagram, mimarinin genel yapısını daha iyi anlamayı sağladı.</li>
</ul>
<p>CNN mimarisinde farklı konvolüsyonel katmanlar, pooling katmanları ve tam bağlı katmanları denedim. Bu denemelerde katman sayısı, filtre boyutları ve tam bağlı katmanlardaki nöron sayıları gibi değişkenler üzerinde oynayarak en iyi performansı elde etmeye çalıştım. Özellikle veri çoğaltma ve normalizasyon gibi görüntü ön işleme adımlarıyla modelin performansını iyileştirdim.</p>
<ul>
<li>Test Sonuçları ve Görselleştirmeler: Raporumda, hem transfer öğrenme yöntemleriyle eğittiğim modellerin hem de sıfırdan oluşturduğum modelin test sonuçlarını sundum. Bu bölümde şu detaylar yer aldı:</li>
</ul>
<p>Kayıp Grafikleri: Eğitim ve doğrulama süreçlerindeki kayıpların nasıl değiştiğini gösteren grafikler ile modellerin eğitim süreçlerindeki ilerlemeyi ve yakınsamalarını değerlendirdim. Karışıklık Matrisleri: Her bir model için karışıklık matrislerini göstererek, modellerin farklı cilt lezyonu sınıflarını doğru sınıflandırma yeteneklerini analiz ettim. Örnek Görseller: Test setinden doğru ve yanlış sınıflandırılmış örnekleri sundum. Bu örnekler modellerin güçlü ve zayıf yanlarını görsel olarak anlamamı sağladı. Performans Karşılaştırma Tablosu: Her modelin doğruluk, kesinlik, geri çağırma ve F1 skorlarını içeren bir tablo ile sonuçların karşılaştırmasını yaptım.</p>
<ul>
<li>Sonuç ve Gelecek Çalışmalar: Deneyimlerimden elde ettiğim ana bulguları ve sonuçları özetledim. Transfer öğrenme yöntemlerinin sıfırdan model oluşturmaya kıyasla daha hızlı ve daha başarılı sonuçlar verebildiğini gözlemledim, özellikle sınırlı veri setleri ile çalışırken transfer öğrenmenin etkili olduğunu fark ettim. Bununla birlikte, sıfırdan model oluşturma süreci, özellikle mimari tasarım üzerinde daha fazla kontrol imkanı sunduğundan, bu tür görevler için yaratıcı çözümler üretme fırsatı sağladı.</li>
</ul>
<p>Gelecekte, daha geniş veri setleri ile daha derin ve karmaşık mimariler deneyerek model performansını artırmayı planlıyorum. Ayrıca, cilt lezyonlarının daha detaylı sınıflandırılması ve daha fazla sınıf eklenmesi, gelecekteki çalışmaların odak noktası olabilir.</p>
</section>
</section>
</section>
<section id="transfer-learning-approach" class="level1">
<h1>1- Transfer learning approach:</h1>
</section>
<section id="model-1-with-frozen-layers" class="level1">
<h1>1.1- Model 1: with frozen layers</h1>
<div id="cell-5" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision.models <span class="im">as</span> models</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision.transforms <span class="im">as</span> transforms</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> DataLoader, Dataset</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torchvision.datasets <span class="im">import</span> ImageFolder</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the dataset class</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># train_dataset = SkinLesionDataset(train_data_dir, train_df, transform=transform)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkinLesionDataset(Dataset):</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data_dir, df, transform<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> data_dir</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> df</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.transform <span class="op">=</span> transform</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index):</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        image_id <span class="op">=</span> <span class="va">self</span>.df.iloc[index][<span class="st">"image_id"</span>]</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        image_path <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>image_id<span class="sc">}</span><span class="ss">.jpg"</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> Image.<span class="bu">open</span>(image_path).convert(<span class="st">"RGB"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            image <span class="op">=</span> <span class="va">self</span>.transform(image)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        label_str <span class="op">=</span> <span class="va">self</span>.df.iloc[index][<span class="st">"label"</span>]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> label_str <span class="op">==</span> <span class="st">"malignant"</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> image, label</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.df)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkinLesionDatasetForTest(Dataset):</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data_dir, df, transform<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> data_dir</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> df</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.transform <span class="op">=</span> transform</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index):</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        image_id <span class="op">=</span> <span class="va">self</span>.df.iloc[index][<span class="st">"image_id"</span>]</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        image_path <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>image_id<span class="sc">}</span><span class="ss">.jpg"</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> Image.<span class="bu">open</span>(image_path).convert(<span class="st">"RGB"</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>            image <span class="op">=</span> <span class="va">self</span>.transform(image)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        label_str <span class="op">=</span> <span class="va">self</span>.df.iloc[index][<span class="st">"label"</span>]</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> label_str <span class="op">==</span> <span class="fl">1.0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> image, label</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.df)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV files</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>train_csv_file <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Training_GroundTruth.csv"</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>val_csv_file <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Validation_GroundTruth.csv"</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>test_csv_file <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Test_GroundTruth.csv"</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.read_csv(train_csv_file, delimiter<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"image_id"</span>, <span class="st">"label"</span>])</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>val_df <span class="op">=</span> pd.read_csv(val_csv_file, delimiter<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"image_id"</span>, <span class="st">"label"</span>])</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.read_csv(test_csv_file, delimiter<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"image_id"</span>, <span class="st">"label"</span>])</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset into training, validation, and test sets</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>train_data_dir <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Training_Data"</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>val_data_dir <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Validation_Data"</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>test_data_dir <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Test_Data"</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the transformations</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>transform <span class="op">=</span> transforms.Compose([</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    transforms.Resize((<span class="dv">224</span>, <span class="dv">224</span>)),</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    transforms.ToTensor(),</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    transforms.Normalize(mean<span class="op">=</span>[<span class="fl">0.485</span>, <span class="fl">0.456</span>, <span class="fl">0.406</span>], std<span class="op">=</span>[<span class="fl">0.229</span>, <span class="fl">0.224</span>, <span class="fl">0.225</span>])</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dataset objects</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> SkinLesionDataset(train_data_dir, train_df, transform<span class="op">=</span>transform)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>val_dataset <span class="op">=</span> SkinLesionDataset(val_data_dir, val_df, transform<span class="op">=</span>transform)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> SkinLesionDatasetForTest(test_data_dir, test_df, transform<span class="op">=</span>transform)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data loaders</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> DataLoader(train_dataset, batch_size<span class="op">=</span>batch_size, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>val_loader <span class="op">=</span> DataLoader(val_dataset, batch_size<span class="op">=</span>batch_size, shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>test_loader <span class="op">=</span> DataLoader(test_dataset, batch_size<span class="op">=</span>batch_size, shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the pretrained ResNet50 model</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> models.resnet50(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the last fully connected layer</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> model.fc.in_features</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>model.fc <span class="op">=</span> nn.Linear(num_features, <span class="dv">2</span>)  <span class="co"># 2 classes: benign and malignant</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Move the model to the device</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> model.to(device)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the loss function and optimizer</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.CrossEntropyLoss()</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Training and evaluation loop</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>num_epochs <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(num_epochs):</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Training</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    model.train()</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    train_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    train_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> train_loader:</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        train_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">+=</span> loss.item() <span class="op">*</span> images.size(<span class="dv">0</span>)</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    train_loss <span class="op">=</span> train_loss <span class="op">/</span> <span class="bu">len</span>(train_dataset)</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    train_acc <span class="op">=</span> train_correct.double() <span class="op">/</span> <span class="bu">len</span>(train_dataset)</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    val_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> images, labels <span class="kw">in</span> val_loader:</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>            images <span class="op">=</span> images.to(device)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>            labels <span class="op">=</span> labels.to(device)</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> model(images)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>            _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>            val_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>            val_loss <span class="op">+=</span> loss.item() <span class="op">*</span> images.size(<span class="dv">0</span>)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> val_loss <span class="op">/</span> <span class="bu">len</span>(val_dataset)</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    val_acc <span class="op">=</span> val_correct.double() <span class="op">/</span> <span class="bu">len</span>(val_dataset)</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Epoch </span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_epochs<span class="sc">}</span><span class="ss">:"</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f" Train Loss: </span><span class="sc">{</span>train_loss<span class="sc">:.4f}</span><span class="ss">, Train Acc: </span><span class="sc">{</span>train_acc<span class="sc">:.4f}</span><span class="ss">,"</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f" Val Loss: </span><span class="sc">{</span>val_loss<span class="sc">:.4f}</span><span class="ss">, Val Acc: </span><span class="sc">{</span>val_acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation on the test set</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>test_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>        test_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>test_acc <span class="op">=</span> test_correct.double() <span class="op">/</span> <span class="bu">len</span>(test_dataset)</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test Accuracy: </span><span class="sc">{</span>test_acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\fklas\AppData\Local\Programs\Python\Python311\Lib\site-packages\torchvision\models\_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
C:\Users\fklas\AppData\Local\Programs\Python\Python311\Lib\site-packages\torchvision\models\_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=ResNet50_Weights.IMAGENET1K_V1`. You can also use `weights=ResNet50_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/10: Train Loss: 0.5386, Train Acc: 0.7901, Val Loss: 13.0946, Val Acc: 0.8667
Epoch 2/10: Train Loss: 0.4343, Train Acc: 0.8111, Val Loss: 0.8220, Val Acc: 0.6111
Epoch 3/10: Train Loss: 0.4542, Train Acc: 0.7914, Val Loss: 0.4609, Val Acc: 0.8667
Epoch 4/10: Train Loss: 0.4548, Train Acc: 0.8037, Val Loss: 0.4562, Val Acc: 0.8333
Epoch 5/10: Train Loss: 0.4845, Train Acc: 0.8012, Val Loss: 5.2942, Val Acc: 0.8667
Epoch 6/10: Train Loss: 0.4583, Train Acc: 0.8086, Val Loss: 0.6526, Val Acc: 0.7333
Epoch 7/10: Train Loss: 0.4698, Train Acc: 0.8037, Val Loss: 0.3620, Val Acc: 0.8778
Epoch 8/10: Train Loss: 0.4457, Train Acc: 0.8025, Val Loss: 0.4424, Val Acc: 0.8778
Epoch 9/10: Train Loss: 0.4188, Train Acc: 0.8173, Val Loss: 0.5997, Val Acc: 0.9000
Epoch 10/10: Train Loss: 0.4061, Train Acc: 0.8210, Val Loss: 0.6453, Val Acc: 0.8778
Test Accuracy: 0.8206</code></pre>
</div>
</div>
</section>
<section id="model-2-with-reduced-architecture" class="level1">
<h1>1.2- Model 2: with reduced architecture</h1>
<div id="cell-7" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the pretrained ResNet50 model with defult weight which is weights=ResNet50_Weights.IMAGENET1K_V1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> models.resnet50(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Unfreeze the last half of the model</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> param <span class="kw">in</span> model_2.layer3.parameters():</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    param.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> param <span class="kw">in</span> model_2.layer4.parameters():</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    param.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the last fully connected layer</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> model_2.fc.in_features</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>model_2.fc <span class="op">=</span> nn.Linear(num_features, <span class="dv">2</span>)  <span class="co"># 2 classes: benign and malignant</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Move the model to the device</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> model_2.to(device)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the loss function and optimizer</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.CrossEntropyLoss()</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>optimizer_2 <span class="op">=</span> optim.Adam(model_2.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Training and evaluation loop for Model 2</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(num_epochs):</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Training</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    model_2.train()</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    train_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    train_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> train_loader:</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        optimizer_2.zero_grad()</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model_2(images)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        train_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        optimizer_2.step()</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">+=</span> loss.item() <span class="op">*</span> images.size(<span class="dv">0</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    train_loss <span class="op">=</span> train_loss <span class="op">/</span> <span class="bu">len</span>(train_dataset)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    train_acc <span class="op">=</span> train_correct.double() <span class="op">/</span> <span class="bu">len</span>(train_dataset)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    model_2.<span class="bu">eval</span>()</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    val_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> images, labels <span class="kw">in</span> val_loader:</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>            images <span class="op">=</span> images.to(device)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>            labels <span class="op">=</span> labels.to(device)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> model_2(images)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>            _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>            val_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>            val_loss <span class="op">+=</span> loss.item() <span class="op">*</span> images.size(<span class="dv">0</span>)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> val_loss <span class="op">/</span> <span class="bu">len</span>(val_dataset)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    val_acc <span class="op">=</span> val_correct.double() <span class="op">/</span> <span class="bu">len</span>(val_dataset)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Model 2 - Epoch </span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_epochs<span class="sc">}</span><span class="ss">:"</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f" Train Loss: </span><span class="sc">{</span>train_loss<span class="sc">:.4f}</span><span class="ss">, Train Acc: </span><span class="sc">{</span>train_acc<span class="sc">:.4f}</span><span class="ss">,"</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f" Val Loss: </span><span class="sc">{</span>val_loss<span class="sc">:.4f}</span><span class="ss">, Val Acc: </span><span class="sc">{</span>val_acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation on the test set for Model 2</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>test_correct_2 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>model_2.<span class="bu">eval</span>()</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model_2(images)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>        test_correct_2 <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>test_acc_2 <span class="op">=</span> test_correct_2.double() <span class="op">/</span> <span class="bu">len</span>(test_dataset)</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Model 2 - Test Accuracy: </span><span class="sc">{</span>test_acc_2<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 2 - Epoch 1/10: Train Loss: 0.6450, Train Acc: 0.7728, Val Loss: 1.4463, Val Acc: 0.8000
Model 2 - Epoch 2/10: Train Loss: 0.4924, Train Acc: 0.8025, Val Loss: 0.7435, Val Acc: 0.7111
Model 2 - Epoch 3/10: Train Loss: 0.4801, Train Acc: 0.7914, Val Loss: 1.4627, Val Acc: 0.7778
Model 2 - Epoch 4/10: Train Loss: 0.4401, Train Acc: 0.8049, Val Loss: 0.7477, Val Acc: 0.6333
Model 2 - Epoch 5/10: Train Loss: 0.4602, Train Acc: 0.8062, Val Loss: 0.5359, Val Acc: 0.8556
Model 2 - Epoch 6/10: Train Loss: 0.4094, Train Acc: 0.8259, Val Loss: 1.3895, Val Acc: 0.4333
Model 2 - Epoch 7/10: Train Loss: 0.4227, Train Acc: 0.8160, Val Loss: 0.5916, Val Acc: 0.8889
Model 2 - Epoch 8/10: Train Loss: 0.4044, Train Acc: 0.8173, Val Loss: 0.6277, Val Acc: 0.7889
Model 2 - Epoch 9/10: Train Loss: 0.3749, Train Acc: 0.8407, Val Loss: 0.5674, Val Acc: 0.8778
Model 2 - Epoch 10/10: Train Loss: 0.3800, Train Acc: 0.8383, Val Loss: 0.4910, Val Acc: 0.8667
Model 2 - Test Accuracy: 0.8100</code></pre>
</div>
</div>
</section>
<section id="model-3-with-partially-open-layers" class="level1">
<h1>1.3- Model 3: with partially open layers</h1>
<div id="cell-9" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the pretrained ResNet50 model with defult weight which is weights=ResNet50_Weights.IMAGENET1K_V1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>model_3 <span class="op">=</span> models.resnet50(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the model into two halves</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>num_layers <span class="op">=</span> <span class="bu">len</span>(<span class="bu">list</span>(model_3.children()))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>split_layer <span class="op">=</span> <span class="bu">int</span>(num_layers <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Freeze the first half of the model</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> param <span class="kw">in</span> model_3.parameters():</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    param.requires_grad <span class="op">=</span> <span class="va">False</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the classifier layer to the end of the first half of the model</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>model_3.fc <span class="op">=</span> nn.Linear(model_3.fc.in_features, <span class="dv">2</span>)  <span class="co"># 2 classes: benign and malignant</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Move the model to the device</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>model_3 <span class="op">=</span> model_3.to(device)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the loss function and optimizer</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.CrossEntropyLoss()</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>optimizer_3 <span class="op">=</span> optim.Adam(model_3.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Training and evaluation loop for Model-3</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(num_epochs):</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Training</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    model_3.train()</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    train_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    train_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> train_loader:</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        optimizer_3.zero_grad()</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model_3(images)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        train_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        optimizer_3.step()</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">+=</span> loss.item() <span class="op">*</span> images.size(<span class="dv">0</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    train_loss <span class="op">=</span> train_loss <span class="op">/</span> <span class="bu">len</span>(train_dataset)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    train_acc <span class="op">=</span> train_correct.double() <span class="op">/</span> <span class="bu">len</span>(train_dataset)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    model_3.<span class="bu">eval</span>()</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    val_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> images, labels <span class="kw">in</span> val_loader:</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>            images <span class="op">=</span> images.to(device)</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>            labels <span class="op">=</span> labels.to(device)</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> model_3(images)</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>            _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>            val_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>            val_loss <span class="op">+=</span> loss.item() <span class="op">*</span> images.size(<span class="dv">0</span>)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> val_loss <span class="op">/</span> <span class="bu">len</span>(val_dataset)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    val_acc <span class="op">=</span> val_correct.double() <span class="op">/</span> <span class="bu">len</span>(val_dataset)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Model 3 - Epoch </span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_epochs<span class="sc">}</span><span class="ss">:"</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f" Train Loss: </span><span class="sc">{</span>train_loss<span class="sc">:.4f}</span><span class="ss">, Train Acc: </span><span class="sc">{</span>train_acc<span class="sc">:.4f}</span><span class="ss">,"</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f" Val Loss: </span><span class="sc">{</span>val_loss<span class="sc">:.4f}</span><span class="ss">, Val Acc: </span><span class="sc">{</span>val_acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation on the test set for Model-3</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>test_correct_3 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>model_3.<span class="bu">eval</span>()</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model_3(images)</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>        test_correct_3 <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>test_acc_3 <span class="op">=</span> test_correct_3.double() <span class="op">/</span> <span class="bu">len</span>(test_dataset)</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Model-3 Test Accuracy: </span><span class="sc">{</span>test_acc_3<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 3 - Epoch 1/10: Train Loss: 0.5055, Train Acc: 0.7975, Val Loss: 0.4412, Val Acc: 0.8556
Model 3 - Epoch 2/10: Train Loss: 0.4295, Train Acc: 0.8148, Val Loss: 0.5671, Val Acc: 0.7556
Model 3 - Epoch 3/10: Train Loss: 0.4247, Train Acc: 0.8148, Val Loss: 0.3774, Val Acc: 0.8667
Model 3 - Epoch 4/10: Train Loss: 0.3726, Train Acc: 0.8370, Val Loss: 0.4966, Val Acc: 0.7889
Model 3 - Epoch 5/10: Train Loss: 0.3781, Train Acc: 0.8346, Val Loss: 0.4125, Val Acc: 0.8667
Model 3 - Epoch 6/10: Train Loss: 0.3361, Train Acc: 0.8506, Val Loss: 0.3548, Val Acc: 0.8889
Model 3 - Epoch 7/10: Train Loss: 0.3577, Train Acc: 0.8519, Val Loss: 0.3344, Val Acc: 0.9000
Model 3 - Epoch 8/10: Train Loss: 0.3788, Train Acc: 0.8457, Val Loss: 0.4833, Val Acc: 0.8000
Model 3 - Epoch 9/10: Train Loss: 0.3386, Train Acc: 0.8617, Val Loss: 0.3358, Val Acc: 0.9000
Model 3 - Epoch 10/10: Train Loss: 0.3262, Train Acc: 0.8580, Val Loss: 0.3409, Val Acc: 0.9000
Model-3 Test Accuracy: 0.8153</code></pre>
</div>
</div>
</section>
<section id="results-of-models" class="level1">
<h1>1.4- Results of Models</h1>
<section id="corect-train---which-means-the-latest-version-of-the-models-result--" class="level3">
<h3 class="anchored" data-anchor-id="corect-train---which-means-the-latest-version-of-the-models-result--">Corect Train - which means the latest version of the models result -</h3>
<section id="model-1---test-accuracy-0.8206" class="level4">
<h4 class="anchored" data-anchor-id="model-1---test-accuracy-0.8206">Model 1 - Test Accuracy: 0.8206<br></h4>
<p>Train Loss: 0.5386, 0.4343, 0.4542, 0.4548, 0.4845, 0.4583, 0.4698, 0.4457, 0.4188, 0.4061<br> Train Acc: 0.7901, 0.8111, 0.7914, 0.8037, 0.8012, 0.8086, 0.8037, 0.8025, 0.8173, 0.8210<br> Val Loss: 13.0946,0.8220, 0.4609, 0.4562, 5.2942, 0.6526, 0.3620, 0.4424, 0.5997, 0.6453<br> Val Acc: 0.8667, 0.6111, 0.8667, 0.8333, 0.8667, 0.7333, 0.8778, 0.8778, 0.9000, 0.8778<br></p>
</section>
<section id="model-2---test-accuracy-0.8100" class="level4">
<h4 class="anchored" data-anchor-id="model-2---test-accuracy-0.8100">Model 2 - Test Accuracy: 0.8100<br></h4>
<p>Train Loss: 0.6450, 0.4924, 0.4801, 0.4401, 0.4602, 0.4094, 0.4227, 0.4044, 0.3749, 0.3800<br> Train Acc: 0.7728, 0.8025, 0.7914, 0.8049, 0.8062, 0.8259, 0.8160, 0.8173, 0.8407, 0.8383<br> Val Loss: 1.4463, 0.7435, 1.4627, 0.7477, 0.5359, 1.3895, 0.5916, 0.6277, 0.5674, 0.4910<br> Val Acc: 0.8000, 0.7111, 0.7778, 0.6333, 0.8556, 0.4333, 0.8889, 0.7889, 0.8778, 0.8667<br></p>
</section>
<section id="model-3-test-accuracy-0.8153" class="level4">
<h4 class="anchored" data-anchor-id="model-3-test-accuracy-0.8153">Model-3 Test Accuracy: 0.8153<br></h4>
<p>Train Loss: 0.5055, 0.4295, 0.4247, 0.3726, 0.3781, 0.3361, 0.3577, 0.3788, 0.3386, 0.3262<br>
Train Acc: 0.7975, 0.8148, 0.8148, 0.8370, 0.8346, 0.8506, 0.8519, 0.8457, 0.8617, 0.8580<br> Val Loss: 0.4412, 0.5671, 0.3774, 0.4966, 0.4125, 0.3548, 0.3344, 0.4833, 0.3358, 0.3409<br> Val Acc: 0.8556, 0.7556, 0.8667, 0.7889, 0.8667, 0.8889, 0.9000, 0.8000, 0.9000, 0.9000<br></p>
<div id="cell-12" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>train_loss_1 <span class="op">=</span> [<span class="fl">0.5386</span>, <span class="fl">0.4343</span>, <span class="fl">0.4542</span>, <span class="fl">0.4548</span>, <span class="fl">0.4845</span>, <span class="fl">0.4583</span>, <span class="fl">0.4698</span>, <span class="fl">0.4457</span>, <span class="fl">0.4188</span>, <span class="fl">0.4061</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>train_acc_1 <span class="op">=</span>  [<span class="fl">0.7901</span>, <span class="fl">0.8111</span>, <span class="fl">0.7914</span>, <span class="fl">0.8037</span>, <span class="fl">0.8012</span>, <span class="fl">0.8086</span>, <span class="fl">0.8037</span>, <span class="fl">0.8025</span>, <span class="fl">0.8173</span>, <span class="fl">0.8210</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>val_loss_1 <span class="op">=</span>   [<span class="fl">13.0946</span>,<span class="fl">0.8220</span>, <span class="fl">0.4609</span>, <span class="fl">0.4562</span>, <span class="fl">5.2942</span>, <span class="fl">0.6526</span>, <span class="fl">0.3620</span>, <span class="fl">0.4424</span>, <span class="fl">0.5997</span>, <span class="fl">0.6453</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>val_acc_1 <span class="op">=</span>    [<span class="fl">0.8667</span>, <span class="fl">0.6111</span>, <span class="fl">0.8667</span>, <span class="fl">0.8333</span>, <span class="fl">0.8667</span>, <span class="fl">0.7333</span>, <span class="fl">0.8778</span>, <span class="fl">0.8778</span>, <span class="fl">0.9000</span>, <span class="fl">0.8778</span>]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>train_loss_2 <span class="op">=</span> [<span class="fl">0.6450</span>, <span class="fl">0.4924</span>, <span class="fl">0.4801</span>, <span class="fl">0.4401</span>, <span class="fl">0.4602</span>, <span class="fl">0.4094</span>, <span class="fl">0.4227</span>, <span class="fl">0.4044</span>, <span class="fl">0.3749</span>, <span class="fl">0.3800</span>]</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>train_acc_2 <span class="op">=</span>  [<span class="fl">0.7728</span>, <span class="fl">0.8025</span>, <span class="fl">0.7914</span>, <span class="fl">0.8049</span>, <span class="fl">0.8062</span>, <span class="fl">0.8259</span>, <span class="fl">0.8160</span>, <span class="fl">0.8173</span>, <span class="fl">0.8407</span>, <span class="fl">0.8383</span>]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>val_loss_2 <span class="op">=</span>   [<span class="fl">1.4463</span>, <span class="fl">0.7435</span>, <span class="fl">1.4627</span>, <span class="fl">0.7477</span>, <span class="fl">0.5359</span>, <span class="fl">1.3895</span>, <span class="fl">0.5916</span>, <span class="fl">0.6277</span>, <span class="fl">0.5674</span>, <span class="fl">0.4910</span>]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>val_acc_2 <span class="op">=</span>    [<span class="fl">0.8000</span>, <span class="fl">0.7111</span>, <span class="fl">0.7778</span>, <span class="fl">0.6333</span>, <span class="fl">0.8556</span>, <span class="fl">0.4333</span>, <span class="fl">0.8889</span>, <span class="fl">0.7889</span>, <span class="fl">0.8778</span>, <span class="fl">0.8667</span>]</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>train_loss_3 <span class="op">=</span> [<span class="fl">0.5055</span>, <span class="fl">0.4295</span>, <span class="fl">0.4247</span>, <span class="fl">0.3726</span>, <span class="fl">0.3781</span>, <span class="fl">0.3361</span>, <span class="fl">0.3577</span>, <span class="fl">0.3788</span>, <span class="fl">0.3386</span>, <span class="fl">0.3262</span>]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>train_acc_3 <span class="op">=</span>  [<span class="fl">0.7975</span>, <span class="fl">0.8148</span>, <span class="fl">0.8148</span>, <span class="fl">0.8370</span>, <span class="fl">0.8346</span>, <span class="fl">0.8506</span>, <span class="fl">0.8519</span>, <span class="fl">0.8457</span>, <span class="fl">0.8617</span>, <span class="fl">0.8580</span>]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>val_loss_3 <span class="op">=</span>   [<span class="fl">0.4412</span>, <span class="fl">0.5671</span>, <span class="fl">0.3774</span>, <span class="fl">0.4966</span>, <span class="fl">0.4125</span>, <span class="fl">0.3548</span>, <span class="fl">0.3344</span>, <span class="fl">0.4833</span>, <span class="fl">0.3358</span>, <span class="fl">0.3409</span>]</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>val_acc_3 <span class="op">=</span>    [<span class="fl">0.8556</span>, <span class="fl">0.7556</span>, <span class="fl">0.8667</span>, <span class="fl">0.7889</span>, <span class="fl">0.8667</span>, <span class="fl">0.8889</span>, <span class="fl">0.9000</span>, <span class="fl">0.8000</span>, <span class="fl">0.9000</span>, <span class="fl">0.9000</span>]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>plt.plot(train_loss_1, label<span class="op">=</span><span class="st">'Model-1 Training Loss'</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>plt.plot(val_loss_1, label<span class="op">=</span><span class="st">'Model-1 Validation Loss'</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>plt.plot(train_loss_2, label<span class="op">=</span><span class="st">'Model-2 Training Loss'</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>plt.plot(val_loss_2, label<span class="op">=</span><span class="st">'Model-2 Validation Loss'</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>plt.plot(train_loss_3, label<span class="op">=</span><span class="st">'Model-3 Training Loss'</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>plt.plot(val_loss_3, label<span class="op">=</span><span class="st">'Model-3 Validation Loss'</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Loss'</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and Validation Loss Curves'</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-previous-model-from-the-models-that-i-trained-correctly-last----" class="level3">
<h3 class="anchored" data-anchor-id="the-previous-model-from-the-models-that-i-trained-correctly-last----">- - ^^ THE PREVİOUS MODEL FROM THE MODELS THAT I TRAINED CORRECTLY LAST ^^- -</h3>
<section id="i-put-this-in-my-notebook-because-there-were-constant-errors-in-the-model-results-that-i-changed-many-times.-especially-in-the-validation_loss-part-and-finally-it-occurred-to-me-that-this-may-due-to-10-validation_data-split-and-i-wanted-to-leave-one-of-the-results-of-my-old-training-models-here.-i-split-first-10-of-training-data-to-validation-data." class="level4">
<h4 class="anchored" data-anchor-id="i-put-this-in-my-notebook-because-there-were-constant-errors-in-the-model-results-that-i-changed-many-times.-especially-in-the-validation_loss-part-and-finally-it-occurred-to-me-that-this-may-due-to-10-validation_data-split-and-i-wanted-to-leave-one-of-the-results-of-my-old-training-models-here.-i-split-first-10-of-training-data-to-validation-data.">(I put this in my notebook because there were constant errors in the model results that I changed many times. Especially in the validation_loss part and finally it occurred to me that this may due to 10% validation_data split and I wanted to leave one of the results of my old training models here. I split first %10 of training data to validation data.)</h4>
</section>
<section id="model-1---test-accuracy-0.8047" class="level4">
<h4 class="anchored" data-anchor-id="model-1---test-accuracy-0.8047">Model 1 - Test Accuracy: 0.8047</h4>
<p>Train Loss:0.5435, 0.4601, 0.4975, 0.4708, 0.4537, 0.4823, 0.4608, 0.4963, 0.4737, 0.4382<br> Train Acc: 0.7963, 0.8062, 0.7951, 0.7988, 0.8025, 0.7975, 0.8074, 0.7938, 0.8123, 0.8074<br> Val Loss: 4.8731, 2.9035, 0.5113, 0.4200, 1.2071, 13.4837,0.6148, 4.5843, 0.4652, 0.6397<br> Val Acc: 0.8222, 0.8667, 0.8778, 0.8778, 0.4778, 0.8222, 0.7667, 0.8556, 0.8778, 0.8667<br></p>
</section>
<section id="model-2---test-accuracy-0.8100-1" class="level4">
<h4 class="anchored" data-anchor-id="model-2---test-accuracy-0.8100-1">Model 2 - Test Accuracy: 0.8100</h4>
<p>Train Loss: 0.5781, 0.5239, 0.4941, 0.4409, 0.4269, 0.4372, 0.4563, 0.4408, 0.4256, 0.3935<br> Train Acc: 0.7741, 0.7877, 0.7963, 0.7975, 0.8247, 0.8086, 0.8210, 0.8062, 0.8210, 0.8247<br> Val Loss: 0.9259, 1.4470, 0.4640, 0.6841, 0.5459, 0.6064, 1.7164, 1.4912, 1.7312, 0.6335<br> Val Acc: 0.7778, 0.8667, 0.8222, 0.7000, 0.8333, 0.8000, 0.8556, 0.6889, 0.8667, 0.8889<br></p>
</section>
<section id="model-3-test-accuracy-0.8364" class="level4">
<h4 class="anchored" data-anchor-id="model-3-test-accuracy-0.8364">Model-3 Test Accuracy: 0.8364</h4>
<p>Train Loss: 0.5033, 0.4161, 0.4176, 0.3682, 0.3681, 0.3344, 0.3283, 0.3475, 0.3082, 0.3123<br> Train Acc: 0.7877, 0.8123, 0.8173, 0.8469, 0.8494, 0.8519, 0.8593, 0.8519, 0.8716, 0.8654<br> Val Loss: 0.3961, 0.3818, 0.5023, 0.3751, 0.4320, 0.4086, 0.4572, 0.3512, 0.4083, 0.3692<br> Val Acc: 0.8667, 0.8667, 0.8111, 0.8778, 0.8222, 0.8556, 0.7889, 0.8889, 0.8333, 0.8778<br></p>
<div id="cell-14" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">####### WRONG ATTEMP LOSS DATAS ########</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>first_train_loss_1 <span class="op">=</span> [<span class="fl">0.5435</span>, <span class="fl">0.4601</span>, <span class="fl">0.4975</span>, <span class="fl">0.4708</span>, <span class="fl">0.4537</span>, <span class="fl">0.4823</span>, <span class="fl">0.4608</span>, <span class="fl">0.4963</span>, <span class="fl">0.4737</span>, <span class="fl">0.4382</span>]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>first_train_acc_1 <span class="op">=</span>  [<span class="fl">0.7963</span>, <span class="fl">0.8062</span>, <span class="fl">0.7951</span>, <span class="fl">0.7988</span>, <span class="fl">0.8025</span>, <span class="fl">0.7975</span>, <span class="fl">0.8074</span>, <span class="fl">0.7938</span>, <span class="fl">0.8123</span>, <span class="fl">0.8074</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>first_val_loss_1 <span class="op">=</span>   [<span class="fl">4.8731</span>, <span class="fl">2.9035</span>, <span class="fl">0.5113</span>, <span class="fl">0.4200</span>, <span class="fl">1.2071</span>, <span class="fl">13.4837</span>,<span class="fl">0.6148</span>, <span class="fl">4.5843</span>, <span class="fl">0.4652</span>, <span class="fl">0.6397</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>first_val_acc_1 <span class="op">=</span>    [<span class="fl">0.8222</span>, <span class="fl">0.8667</span>, <span class="fl">0.8778</span>, <span class="fl">0.8778</span>, <span class="fl">0.4778</span>, <span class="fl">0.8222</span>, <span class="fl">0.7667</span>, <span class="fl">0.8556</span>, <span class="fl">0.8778</span>, <span class="fl">0.8667</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>first_train_loss_2 <span class="op">=</span> [<span class="fl">0.5781</span>, <span class="fl">0.5239</span>, <span class="fl">0.4941</span>, <span class="fl">0.4409</span>, <span class="fl">0.4269</span>, <span class="fl">0.4372</span>, <span class="fl">0.4563</span>, <span class="fl">0.4408</span>, <span class="fl">0.4256</span>, <span class="fl">0.3935</span>]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>first_train_acc_2 <span class="op">=</span>  [<span class="fl">0.7741</span>, <span class="fl">0.7877</span>, <span class="fl">0.7963</span>, <span class="fl">0.7975</span>, <span class="fl">0.8247</span>, <span class="fl">0.8086</span>, <span class="fl">0.8210</span>, <span class="fl">0.8062</span>, <span class="fl">0.8210</span>, <span class="fl">0.8247</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>first_val_loss_2 <span class="op">=</span>   [<span class="fl">0.9259</span>, <span class="fl">1.4470</span>, <span class="fl">0.4640</span>, <span class="fl">0.6841</span>, <span class="fl">0.5459</span>, <span class="fl">0.6064</span>, <span class="fl">1.7164</span>, <span class="fl">1.4912</span>, <span class="fl">1.7312</span>, <span class="fl">0.6335</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>first_val_acc_2 <span class="op">=</span>    [<span class="fl">0.7778</span>, <span class="fl">0.8667</span>, <span class="fl">0.8222</span>, <span class="fl">0.7000</span>, <span class="fl">0.8333</span>, <span class="fl">0.8000</span>, <span class="fl">0.8556</span>, <span class="fl">0.6889</span>, <span class="fl">0.8667</span>, <span class="fl">0.8889</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>first_train_loss_3 <span class="op">=</span> [<span class="fl">0.5033</span>, <span class="fl">0.4161</span>, <span class="fl">0.4176</span>, <span class="fl">0.3682</span>, <span class="fl">0.3681</span>, <span class="fl">0.3344</span>, <span class="fl">0.3283</span>, <span class="fl">0.3475</span>, <span class="fl">0.3082</span>, <span class="fl">0.3123</span>]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>first_train_acc_3 <span class="op">=</span>  [<span class="fl">0.7877</span>, <span class="fl">0.8123</span>, <span class="fl">0.8173</span>, <span class="fl">0.8469</span>, <span class="fl">0.8494</span>, <span class="fl">0.8519</span>, <span class="fl">0.8593</span>, <span class="fl">0.8519</span>, <span class="fl">0.8716</span>, <span class="fl">0.8654</span>]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>first_val_loss_3 <span class="op">=</span>   [<span class="fl">0.3961</span>, <span class="fl">0.3818</span>, <span class="fl">0.5023</span>, <span class="fl">0.3751</span>, <span class="fl">0.4320</span>, <span class="fl">0.4086</span>, <span class="fl">0.4572</span>, <span class="fl">0.3512</span>, <span class="fl">0.4083</span>, <span class="fl">0.3692</span>]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>first_val_acc_3 <span class="op">=</span>    [<span class="fl">0.8667</span>, <span class="fl">0.8667</span>, <span class="fl">0.8111</span>, <span class="fl">0.8778</span>, <span class="fl">0.8222</span>, <span class="fl">0.8556</span>, <span class="fl">0.7889</span>, <span class="fl">0.8889</span>, <span class="fl">0.8333</span>, <span class="fl">0.8778</span>]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>plt.plot(first_train_loss_1, label<span class="op">=</span><span class="st">'Model-1 TL'</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>plt.plot(first_val_loss_1, label<span class="op">=</span><span class="st">'Model-1 VL'</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>plt.plot(first_train_loss_2, label<span class="op">=</span><span class="st">'Model-2 TL'</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>plt.plot(first_val_loss_2, label<span class="op">=</span><span class="st">'Model-2 VL'</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>plt.plot(first_train_loss_3, label<span class="op">=</span><span class="st">'Model-3 TL'</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>plt.plot(first_val_loss_3, label<span class="op">=</span><span class="st">'Model-3 VL'</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Loss'</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'PREVİOUS MODEL loss curves -from old train-'</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-1-loss-curves" class="level2">
<h2 class="anchored" data-anchor-id="model-1-loss-curves">Model 1 loss curves</h2>
<div id="cell-16" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>train_loss_1 <span class="op">=</span> [<span class="fl">0.5386</span>, <span class="fl">0.4343</span>, <span class="fl">0.4542</span>, <span class="fl">0.4548</span>, <span class="fl">0.4845</span>, <span class="fl">0.4583</span>, <span class="fl">0.4698</span>, <span class="fl">0.4457</span>, <span class="fl">0.4188</span>, <span class="fl">0.4061</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>train_acc_1 <span class="op">=</span>  [<span class="fl">0.7901</span>, <span class="fl">0.8111</span>, <span class="fl">0.7914</span>, <span class="fl">0.8037</span>, <span class="fl">0.8012</span>, <span class="fl">0.8086</span>, <span class="fl">0.8037</span>, <span class="fl">0.8025</span>, <span class="fl">0.8173</span>, <span class="fl">0.8210</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>val_loss_1 <span class="op">=</span>   [<span class="fl">13.0946</span>,<span class="fl">0.8220</span>, <span class="fl">0.4609</span>, <span class="fl">0.4562</span>, <span class="fl">5.2942</span>, <span class="fl">0.6526</span>, <span class="fl">0.3620</span>, <span class="fl">0.4424</span>, <span class="fl">0.5997</span>, <span class="fl">0.6453</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>val_acc_1 <span class="op">=</span>    [<span class="fl">0.8667</span>, <span class="fl">0.6111</span>, <span class="fl">0.8667</span>, <span class="fl">0.8333</span>, <span class="fl">0.8667</span>, <span class="fl">0.7333</span>, <span class="fl">0.8778</span>, <span class="fl">0.8778</span>, <span class="fl">0.9000</span>, <span class="fl">0.8778</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.plot(train_loss_1, label<span class="op">=</span><span class="st">'Model-1 Training Loss'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.plot(val_loss_1, label<span class="op">=</span><span class="st">'Model-1 Validation Loss'</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Loss'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and Validation Loss Curves of Model-1'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-2-loss-curves" class="level2">
<h2 class="anchored" data-anchor-id="model-2-loss-curves">Model 2 loss curves</h2>
<div id="cell-18" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>train_loss_2 <span class="op">=</span> [<span class="fl">0.6450</span>, <span class="fl">0.4924</span>, <span class="fl">0.4801</span>, <span class="fl">0.4401</span>, <span class="fl">0.4602</span>, <span class="fl">0.4094</span>, <span class="fl">0.4227</span>, <span class="fl">0.4044</span>, <span class="fl">0.3749</span>, <span class="fl">0.3800</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>train_acc_2 <span class="op">=</span>  [<span class="fl">0.7728</span>, <span class="fl">0.8025</span>, <span class="fl">0.7914</span>, <span class="fl">0.8049</span>, <span class="fl">0.8062</span>, <span class="fl">0.8259</span>, <span class="fl">0.8160</span>, <span class="fl">0.8173</span>, <span class="fl">0.8407</span>, <span class="fl">0.8383</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>val_loss_2 <span class="op">=</span>   [<span class="fl">1.4463</span>, <span class="fl">0.7435</span>, <span class="fl">1.4627</span>, <span class="fl">0.7477</span>, <span class="fl">0.5359</span>, <span class="fl">1.3895</span>, <span class="fl">0.5916</span>, <span class="fl">0.6277</span>, <span class="fl">0.5674</span>, <span class="fl">0.4910</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>val_acc_2 <span class="op">=</span>    [<span class="fl">0.8000</span>, <span class="fl">0.7111</span>, <span class="fl">0.7778</span>, <span class="fl">0.6333</span>, <span class="fl">0.8556</span>, <span class="fl">0.4333</span>, <span class="fl">0.8889</span>, <span class="fl">0.7889</span>, <span class="fl">0.8778</span>, <span class="fl">0.8667</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>plt.plot(train_loss_2, label<span class="op">=</span><span class="st">'Model-2 Training Loss'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>plt.plot(val_loss_2, label<span class="op">=</span><span class="st">'Model-2 Validation Loss'</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Loss'</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and Validation Loss Curves of Model-2'</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-3-loss-curves" class="level2">
<h2 class="anchored" data-anchor-id="model-3-loss-curves">Model 3 loss curves</h2>
<div id="cell-20" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>train_loss_3 <span class="op">=</span> [<span class="fl">0.5055</span>, <span class="fl">0.4295</span>, <span class="fl">0.4247</span>, <span class="fl">0.3726</span>, <span class="fl">0.3781</span>, <span class="fl">0.3361</span>, <span class="fl">0.3577</span>, <span class="fl">0.3788</span>, <span class="fl">0.3386</span>, <span class="fl">0.3262</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>train_acc_3 <span class="op">=</span>  [<span class="fl">0.7975</span>, <span class="fl">0.8148</span>, <span class="fl">0.8148</span>, <span class="fl">0.8370</span>, <span class="fl">0.8346</span>, <span class="fl">0.8506</span>, <span class="fl">0.8519</span>, <span class="fl">0.8457</span>, <span class="fl">0.8617</span>, <span class="fl">0.8580</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>val_loss_3 <span class="op">=</span>   [<span class="fl">0.4412</span>, <span class="fl">0.5671</span>, <span class="fl">0.3774</span>, <span class="fl">0.4966</span>, <span class="fl">0.4125</span>, <span class="fl">0.3548</span>, <span class="fl">0.3344</span>, <span class="fl">0.4833</span>, <span class="fl">0.3358</span>, <span class="fl">0.3409</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>val_acc_3 <span class="op">=</span>    [<span class="fl">0.8556</span>, <span class="fl">0.7556</span>, <span class="fl">0.8667</span>, <span class="fl">0.7889</span>, <span class="fl">0.8667</span>, <span class="fl">0.8889</span>, <span class="fl">0.9000</span>, <span class="fl">0.8000</span>, <span class="fl">0.9000</span>, <span class="fl">0.9000</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.plot(train_loss_3, label<span class="op">=</span><span class="st">'Model-3 Training Loss'</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.plot(val_loss_3, label<span class="op">=</span><span class="st">'Model-3 Validation Loss'</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Loss'</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and Validation Loss Curves of Mod#### Model 2 loss curvesel-3'</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="reporting-of-step-1-transfer-learning-approach" class="level1">
<h1>1.5- Reporting of Step 1: Transfer Learning Approach</h1>
<section id="confusion-matrix-classification-report-precision-recall-f1-score-and-support" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix-classification-report-precision-recall-f1-score-and-support">1.5.1- Confusion matrix, Classification Report: precision, recall, f1-score, and support</h2>
<section id="confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-1" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-1">1.5.1.1- Confusion matrix, Classification Report: precision, recall, f1-score, and support of the model 1</h3>
<div id="cell-24" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation on the test set</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> []</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>test_labels <span class="op">=</span> []</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        test_predictions.extend(preds.cpu().numpy())</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        test_labels.extend(labels.cpu().numpy())</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> np.array(test_predictions)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>test_labels <span class="op">=</span> np.array(test_labels)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification Report:"</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_labels, test_predictions))</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate confusion matrix</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Confusion Matrix:"</span>)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(test_labels, test_predictions)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classification Report:
              precision    recall  f1-score   support

           0       0.84      0.96      0.90       304
           1       0.62      0.24      0.35        75

    accuracy                           0.82       379
   macro avg       0.73      0.60      0.62       379
weighted avg       0.79      0.82      0.79       379

Confusion Matrix:
[[293  11]
 [ 57  18]]</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-2" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-2">1.5.1.2- Confusion matrix, Classification Report: precision, recall, f1-score, and support of the model 2</h3>
<div id="cell-26" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation on the test set</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> []</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>test_labels <span class="op">=</span> []</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>model_2.<span class="bu">eval</span>()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model_2(images)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        test_predictions.extend(preds.cpu().numpy())</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        test_labels.extend(labels.cpu().numpy())</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> np.array(test_predictions)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>test_labels <span class="op">=</span> np.array(test_labels)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification Report:"</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_labels, test_predictions))</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate confusion matrix</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Confusion Matrix:"</span>)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(test_labels, test_predictions)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classification Report:
              precision    recall  f1-score   support

           0       0.82      0.98      0.89       304
           1       0.59      0.13      0.22        75

    accuracy                           0.81       379
   macro avg       0.70      0.56      0.55       379
weighted avg       0.77      0.81      0.76       379

Confusion Matrix:
[[297   7]
 [ 65  10]]</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-3" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-classification-report-precision-recall-f1-score-and-support-of-the-model-3">1.5.1.3- Confusion matrix, Classification Report: precision, recall, f1-score, and support of the model 3</h3>
<div id="cell-28" class="cell" data-scrolled="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation on the test set</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> []</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>test_labels <span class="op">=</span> []</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>model_3.<span class="bu">eval</span>()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model_3(images)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        test_predictions.extend(preds.cpu().numpy())</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        test_labels.extend(labels.cpu().numpy())</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> np.array(test_predictions)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>test_labels <span class="op">=</span> np.array(test_labels)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification Report:"</span>)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_labels, test_predictions))</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate confusion matrix</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Confusion Matrix:"</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(test_labels, test_predictions)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classification Report:
              precision    recall  f1-score   support

           0       0.82      0.98      0.90       304
           1       0.67      0.13      0.22        75

    accuracy                           0.82       379
   macro avg       0.74      0.56      0.56       379
weighted avg       0.79      0.82      0.76       379

Confusion Matrix:
[[299   5]
 [ 65  10]]</code></pre>
</div>
</div>
</section>
</section>
<section id="example-of-correctly-classified-samples-and-incorrectly-classified-samples" class="level2">
<h2 class="anchored" data-anchor-id="example-of-correctly-classified-samples-and-incorrectly-classified-samples">1.5.2- Example of Correctly Classified Samples and Incorrectly Classified Samples</h2>
<section id="example-of-correctly-classified-samples-and-incorrectly-classified-samples-of-model-1" class="level4">
<h4 class="anchored" data-anchor-id="example-of-correctly-classified-samples-and-incorrectly-classified-samples-of-model-1">1.5.2.1- Example of Correctly Classified Samples and Incorrectly Classified Samples of model 1</h4>
<div id="cell-31" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display images</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_images(images, labels, predicted_labels, title):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(images)), figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(title, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes.flat):</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(images):</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            ax.imshow(images[i].permute(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>            ax.axis(<span class="st">'off'</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f"True: </span><span class="sc">{</span>labels[i]<span class="sc">}</span><span class="ch">\n</span><span class="ss">Pred: </span><span class="sc">{</span>predicted_labels[i]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            ax.axis(<span class="st">'off'</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a batch of test images and labels</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>images, labels <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(test_loader))</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Move images to device</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> images.to(device)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get model predictions</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> model(images)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices of correctly and incorrectly classified images</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>correct_indices <span class="op">=</span> (preds <span class="op">==</span> labels).nonzero().squeeze()</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>incorrect_indices <span class="op">=</span> (preds <span class="op">!=</span> labels).nonzero().squeeze()</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Select correctly classified images</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>num_correct <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(correct_indices))</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>correct_images <span class="op">=</span> images[correct_indices][:num_correct]</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>correct_labels <span class="op">=</span> labels[correct_indices][:num_correct]</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>correct_preds <span class="op">=</span> preds[correct_indices][:num_correct]</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Select incorrectly classified images</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>num_incorrect <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(incorrect_indices))</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>incorrect_images <span class="op">=</span> images[incorrect_indices][:num_incorrect]</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>incorrect_labels <span class="op">=</span> labels[incorrect_indices][:num_incorrect]</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>incorrect_preds <span class="op">=</span> preds[incorrect_indices][:num_incorrect]</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the selected images</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>show_images(correct_images, correct_labels, correct_preds, <span class="st">"Correctly Classified Samples"</span>)</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>show_images(incorrect_images, incorrect_labels, incorrect_preds, <span class="st">"Incorrectly Classified Samples"</span>)</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the images</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-of-correctly-classified-samples-and-incorrectly-classified-samples-of-model-2" class="level4">
<h4 class="anchored" data-anchor-id="example-of-correctly-classified-samples-and-incorrectly-classified-samples-of-model-2">1.5.2.2- Example of Correctly Classified Samples and Incorrectly Classified Samples of model 2</h4>
<div id="cell-33" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display images</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_images(images, labels, predicted_labels, title):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(images)), figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(title, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes.flat):</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(images):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            ax.imshow(images[i].permute(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            ax.axis(<span class="st">'off'</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f"True: </span><span class="sc">{</span>labels[i]<span class="sc">}</span><span class="ch">\n</span><span class="ss">Pred: </span><span class="sc">{</span>predicted_labels[i]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            ax.axis(<span class="st">'off'</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a batch of test images and label</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>images, labels <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(test_loader))</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Device</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> images.to(device)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get model predictions</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>model_2.<span class="bu">eval</span>()</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> model_2(images)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices of correctly and incorrectly classified imagess. Lieted with 5 </span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>correct_indices <span class="op">=</span> (preds <span class="op">==</span> labels).nonzero().squeeze()</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>incorrect_indices <span class="op">=</span> (preds <span class="op">!=</span> labels).nonzero().squeeze()</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Select correctly classified images</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>num_correct <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(correct_indices))</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>correct_images <span class="op">=</span> images[correct_indices][:num_correct]</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>correct_labels <span class="op">=</span> labels[correct_indices][:num_correct]</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>correct_preds <span class="op">=</span> preds[correct_indices][:num_correct]</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Select incorrectly classified images</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>num_incorrect <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(incorrect_indices))</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>incorrect_images <span class="op">=</span> images[incorrect_indices][:num_incorrect]</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>incorrect_labels <span class="op">=</span> labels[incorrect_indices][:num_incorrect]</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>incorrect_preds <span class="op">=</span> preds[incorrect_indices][:num_incorrect]</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the selected images</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>show_images(correct_images, correct_labels, correct_preds, <span class="st">"Correctly Classified Samples"</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>show_images(incorrect_images, incorrect_labels, incorrect_preds, <span class="st">"Incorrectly Classified Samples"</span>)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the images</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-14-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-of-correctly-classified-samples-and-incorrectly-classified-samples-of-model-3" class="level4">
<h4 class="anchored" data-anchor-id="example-of-correctly-classified-samples-and-incorrectly-classified-samples-of-model-3">1.5.2.3- Example of Correctly Classified Samples and Incorrectly Classified Samples of model 3</h4>
<div id="cell-35" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display images</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_images(images, labels, predicted_labels, title):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(images)), figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(title, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes.flat):</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(images):</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>            ax.imshow(images[i].permute(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>            ax.axis(<span class="st">'off'</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f"True: </span><span class="sc">{</span>labels[i]<span class="sc">}</span><span class="ch">\n</span><span class="ss">Pred: </span><span class="sc">{</span>predicted_labels[i]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            ax.axis(<span class="st">'off'</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a batch of test images and labels a</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>images, labels <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(test_loader))</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co"># choose a device for runnin</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> images.to(device)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get model prediction</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>model_3.<span class="bu">eval</span>()</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> model_3(images)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices of correctly andincorrectly classified images. Limeted with 5</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>correct_indices <span class="op">=</span> (preds <span class="op">==</span> labels).nonzero().squeeze()</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>incorrect_indices <span class="op">=</span> (preds <span class="op">!=</span> labels).nonzero().squeeze()</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Select correctly classified images</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>num_correct <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(correct_indices))</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>correct_images <span class="op">=</span> images[correct_indices][:num_correct]</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>correct_labels <span class="op">=</span> labels[correct_indices][:num_correct]</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>correct_preds <span class="op">=</span> preds[correct_indices][:num_correct]</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Select incorrectly classified images</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>num_incorrect <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(incorrect_indices))</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>incorrect_images <span class="op">=</span> images[incorrect_indices][:num_incorrect]</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>incorrect_labels <span class="op">=</span> labels[incorrect_indices][:num_incorrect]</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>incorrect_preds <span class="op">=</span> preds[incorrect_indices][:num_incorrect]</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the selected images</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>show_images(correct_images, correct_labels, correct_preds, <span class="st">"Correctly Classified Samples"</span>)</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>show_images(incorrect_images, incorrect_labels, incorrect_preds, <span class="st">"Incorrectly Classified Samples"</span>)</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the images</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-15-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-15-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="step2-building-an-image-classification-model-from-scratch-1" class="level1">
<h1>Step2: Building an Image Classification Model From Scratch</h1>
<div id="cell-37" class="cell" data-scrolled="true" data-execution_count="62">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> DataLoader</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision.transforms <span class="im">as</span> transforms</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torchvision.datasets <span class="im">import</span> ImageFolder</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------- custom CNN architecture ----------------------------------- #</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkinLesionClassifier(nn.Module):</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, num_classes):</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(SkinLesionClassifier, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convolutional Layers: </span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The features sequential module contains three sets of operations: </span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># a 2D convolutional layer, a ReLU activation function, and a max pooling layer. </span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This pattern is repeated three times to extract features from the input images at </span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># different spatial resolutions.</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.features <span class="op">=</span> nn.Sequential(</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">3</span>, <span class="dv">32</span>, kernel_size<span class="op">=</span><span class="dv">3</span>, stride<span class="op">=</span><span class="dv">1</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(inplace<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(kernel_size<span class="op">=</span><span class="dv">2</span>, stride<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">32</span>, <span class="dv">64</span>, kernel_size<span class="op">=</span><span class="dv">3</span>, stride<span class="op">=</span><span class="dv">1</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(inplace<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(kernel_size<span class="op">=</span><span class="dv">2</span>, stride<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">64</span>, <span class="dv">128</span>, kernel_size<span class="op">=</span><span class="dv">3</span>, stride<span class="op">=</span><span class="dv">1</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(inplace<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(kernel_size<span class="op">=</span><span class="dv">2</span>, stride<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fully Connected Layers: The classifier sequential module consists of two fully connected layers. </span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The first fully connected layer has 128 * 28 * 28 input features, </span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># which corresponds to the flattened output of the last convolutional layer. </span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># It applies a ReLU activation function and dropout regularization. </span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The final fully connected layer reduces the feature dimensionality to num_classes, </span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># representing the number of classes in the classification task.</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.classifier <span class="op">=</span> nn.Sequential(</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">128</span> <span class="op">*</span> <span class="dv">28</span> <span class="op">*</span> <span class="dv">28</span>, <span class="dv">512</span>),</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(inplace<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(<span class="fl">0.5</span>),</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">512</span>, num_classes)</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The forward method defines the forward pass of the model, </span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># where the input x flows through the convolutional layers (features) and is then flattened.</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.features(x)</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> x.view(x.size(<span class="dv">0</span>), <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flattened tensor passes through the fully connected layers (classifier) to produce the output logits.</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.classifier(x)</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the transformation pipeline for image preprocessing</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>transform <span class="op">=</span> transforms.Compose([</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>    transforms.Resize((<span class="dv">224</span>, <span class="dv">224</span>)),</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>    transforms.ToTensor(),</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>    transforms.Normalize(mean<span class="op">=</span>[<span class="fl">0.485</span>, <span class="fl">0.456</span>, <span class="fl">0.406</span>], std<span class="op">=</span>[<span class="fl">0.229</span>, <span class="fl">0.224</span>, <span class="fl">0.225</span>])</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the dataset class for training and validation</span></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkinLesionDataset(Dataset):</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data_dir, df, transform<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> data_dir</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> df</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.transform <span class="op">=</span> transform</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index):</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>        image_id <span class="op">=</span> <span class="va">self</span>.df.iloc[index][<span class="st">"image_id"</span>]</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>        image_path <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>image_id<span class="sc">}</span><span class="ss">.jpg"</span></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> Image.<span class="bu">open</span>(image_path).convert(<span class="st">"RGB"</span>)</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>            image <span class="op">=</span> <span class="va">self</span>.transform(image)</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>        label_str <span class="op">=</span> <span class="va">self</span>.df.iloc[index][<span class="st">"label"</span>]</span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> label_str <span class="op">==</span> <span class="st">"malignant"</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> image, label</span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.df)</span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the dataset class for testing because labels are different for test data</span></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkinLesionDatasetForTest(Dataset):</span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data_dir, df, transform<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> data_dir</span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> df</span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.transform <span class="op">=</span> transform</span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index):</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>        image_id <span class="op">=</span> <span class="va">self</span>.df.iloc[index][<span class="st">"image_id"</span>]</span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>        image_path <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>image_id<span class="sc">}</span><span class="ss">.jpg"</span></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> Image.<span class="bu">open</span>(image_path).convert(<span class="st">"RGB"</span>)</span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>            image <span class="op">=</span> <span class="va">self</span>.transform(image)</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>        label_str <span class="op">=</span> <span class="va">self</span>.df.iloc[index][<span class="st">"label"</span>]</span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> label_str <span class="op">==</span> <span class="fl">1.0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> image, label</span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.df)</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading the CSV files</span></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a>train_csv_file <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Training_GroundTruth.csv"</span></span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a>val_csv_file <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Validation_GroundTruth.csv"</span></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a>test_csv_file <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Test_GroundTruth.csv"</span></span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.read_csv(train_csv_file, delimiter<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"image_id"</span>, <span class="st">"label"</span>])</span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a>val_df <span class="op">=</span> pd.read_csv(val_csv_file, delimiter<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"image_id"</span>, <span class="st">"label"</span>])</span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.read_csv(test_csv_file, delimiter<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"image_id"</span>, <span class="st">"label"</span>])</span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Spliting the dataset into training, validation, and test sets</span></span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a>train_data_dir <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Training_Data"</span></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a>val_data_dir <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Validation_Data"</span></span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>test_data_dir <span class="op">=</span> <span class="st">"ISBI2016_ISIC_Test_Data"</span></span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the dataset objects</span></span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> SkinLesionDataset(train_data_dir, train_df, transform<span class="op">=</span>transform)</span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a>val_dataset <span class="op">=</span> SkinLesionDataset(val_data_dir, val_df, transform<span class="op">=</span>transform)</span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> SkinLesionDatasetForTest(test_data_dir, test_df, transform<span class="op">=</span>transform)</span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the data loaders</span></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> DataLoader(train_dataset, batch_size<span class="op">=</span>batch_size, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a>val_loader <span class="op">=</span> DataLoader(val_dataset, batch_size<span class="op">=</span>batch_size, shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a>test_loader <span class="op">=</span> DataLoader(test_dataset, batch_size<span class="op">=</span>batch_size, shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating an instance of the skin lesion classifier</span></span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SkinLesionClassifier(num_classes<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a><span class="co"># choose device for short run</span></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> model.to(device)</span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the loss function and optimizer</span></span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.CrossEntropyLoss()</span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Training and evaluation loopss</span></span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a>num_epochs <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(num_epochs):</span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Training</span></span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a>    model.train()</span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a>    train_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a>    train_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> train_loader:</span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-163"><a href="#cb25-163" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb25-164"><a href="#cb25-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-165"><a href="#cb25-165" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-168"><a href="#cb25-168" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb25-169"><a href="#cb25-169" aria-hidden="true" tabindex="-1"></a>        train_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb25-173"><a href="#cb25-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-174"><a href="#cb25-174" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">+=</span> loss.item() <span class="op">*</span> images.size(<span class="dv">0</span>)</span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a>    train_loss <span class="op">=</span> train_loss <span class="op">/</span> <span class="bu">len</span>(train_dataset)</span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a>    train_acc <span class="op">=</span> train_correct.double() <span class="op">/</span> <span class="bu">len</span>(train_dataset)</span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation d</span></span>
<span id="cb25-180"><a href="#cb25-180" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb25-181"><a href="#cb25-181" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a>    val_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> images, labels <span class="kw">in</span> val_loader:</span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a>            images <span class="op">=</span> images.to(device)</span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a>            labels <span class="op">=</span> labels.to(device)</span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> model(images)</span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>            _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a>            val_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a>            val_loss <span class="op">+=</span> loss.item() <span class="op">*</span> images.size(<span class="dv">0</span>)</span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> val_loss <span class="op">/</span> <span class="bu">len</span>(val_dataset)</span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a>    val_acc <span class="op">=</span> val_correct.double() <span class="op">/</span> <span class="bu">len</span>(val_dataset)</span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Epoch </span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_epochs<span class="sc">}</span><span class="ss">:"</span></span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f" Train Loss: </span><span class="sc">{</span>train_loss<span class="sc">:.4f}</span><span class="ss">, Train Acc: </span><span class="sc">{</span>train_acc<span class="sc">:.4f}</span><span class="ss">,"</span></span>
<span id="cb25-202"><a href="#cb25-202" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f" Val Loss: </span><span class="sc">{</span>val_loss<span class="sc">:.4f}</span><span class="ss">, Val Acc: </span><span class="sc">{</span>val_acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb25-203"><a href="#cb25-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation on the test set</span></span>
<span id="cb25-205"><a href="#cb25-205" aria-hidden="true" tabindex="-1"></a>test_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-206"><a href="#cb25-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb25-214"><a href="#cb25-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-215"><a href="#cb25-215" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a>        test_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb25-217"><a href="#cb25-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-218"><a href="#cb25-218" aria-hidden="true" tabindex="-1"></a>test_acc <span class="op">=</span> test_correct.double()<span class="op">/</span> <span class="bu">len</span>(test_dataset)</span>
<span id="cb25-219"><a href="#cb25-219" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test Accuracy: </span><span class="sc">{</span>test_acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/10: Train Loss: 0.6883, Train Acc: 0.7840, Val Loss: 1.0978, Val Acc: 0.8667
Epoch 2/10: Train Loss: 0.4775, Train Acc: 0.8012, Val Loss: 0.7613, Val Acc: 0.8667
Epoch 3/10: Train Loss: 0.4766, Train Acc: 0.8012, Val Loss: 1.1496, Val Acc: 0.8667
Epoch 4/10: Train Loss: 0.4573, Train Acc: 0.8012, Val Loss: 0.5120, Val Acc: 0.8667
Epoch 5/10: Train Loss: 0.4660, Train Acc: 0.8025, Val Loss: 2.1202, Val Acc: 0.8667
Epoch 6/10: Train Loss: 0.4578, Train Acc: 0.7975, Val Loss: 2.8478, Val Acc: 0.8667
Epoch 7/10: Train Loss: 0.4420, Train Acc: 0.8123, Val Loss: 0.4304, Val Acc: 0.8667
Epoch 8/10: Train Loss: 0.4364, Train Acc: 0.8160, Val Loss: 0.5747, Val Acc: 0.8667
Epoch 9/10: Train Loss: 0.4234, Train Acc: 0.8099, Val Loss: 1.2480, Val Acc: 0.7333
Epoch 10/10: Train Loss: 0.4211, Train Acc: 0.8185, Val Loss: 1.7306, Val Acc: 0.8778
Test Accuracy: 0.8047</code></pre>
</div>
</div>
<section id="i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence." class="level2">
<h2 class="anchored" data-anchor-id="i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence.">I thought the model did not prerdict any 1 but when I look at a few more pictures and than I see it. It was just a coincidence.</h2>
<div id="cell-39" class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I was looking why model is not predicting 1 but it seems it predict 1.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>test_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        x, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)<span class="co">## I thought the model did not prerdict any 1 but when I look at a few more pictures and than I see it. It was just a coincidence.</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(x)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        test_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>test_acc <span class="op">=</span> test_correct.double()<span class="op">/</span> <span class="bu">len</span>(test_dataset)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test Accuracy: </span><span class="sc">{</span>test_acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor([ 0.0937,  2.1015,  3.6010,  2.4113,  1.9821,  1.7362,  1.2605,  0.8603,
         1.7896,  5.0396,  5.2531, 50.8374,  2.6454,  1.1652,  1.7367,  0.9046,
         1.6091,  1.8293,  2.7449,  3.1041,  0.3036,  3.9430,  1.1789,  1.3454,
         2.3033,  1.4861,  2.7959,  1.0077,  1.6401,  2.3750,  0.9363,  0.5674])
tensor([2.5817, 0.9873, 1.3215, 1.5310, 2.2378, 1.4115, 1.6017, 0.3990, 1.4902,
        0.4133, 1.6955, 0.1113, 0.2570, 1.0877, 1.4184, 0.9930, 2.4602, 2.8013,
        1.4107, 1.5000, 0.6790, 1.3751, 2.0535, 0.2843, 0.2412, 2.1956, 1.1011,
        0.7443, 1.7058, 1.3067, 1.9446, 0.0089])
tensor([ 0.8349,  0.3133,  1.3670,  3.3524,  3.5384,  0.2645,  1.5857,  3.4304,
        -0.4512, -0.3601,  0.1897,  2.4914, -0.0942,  0.1356,  2.0123, -0.0498,
         0.3288,  1.7425,  0.9330,  1.4010,  1.8567,  1.6810,  2.2702,  0.1694,
        -0.0960,  2.9003,  0.4485, -0.2392,  2.4882,  0.7698,  0.7547,  1.2207])
tensor([1.5043, 1.0157, 1.2613, 3.0613, 0.2635, 1.1433, 1.2761, 0.9536, 0.7417,
        1.4428, 2.0577, 1.7440, 0.3943, 2.7956, 1.1047, 1.3567, 1.5960, 1.1970,
        2.2807, 1.1686, 1.8387, 0.1625, 1.2236, 1.0147, 0.8317, 0.5501, 0.3410,
        0.8569, 1.2969, 0.1061, 1.9943, 0.7279])
tensor([ 0.8545,  0.8127,  1.2135,  4.1292,  1.6904,  0.9264, -0.2408,  1.1856,
         1.8489, 87.4981,  1.4319,  5.9103, 20.6343, -0.2789, 16.8895,  4.6065,
         3.1078, 42.5545,  4.8674, 43.5815, 79.5309, 29.3269,  4.9300, 19.0257,
        29.0336, 17.5688,  1.6997,  9.8101,  2.4479, 24.4624, 16.1752, 79.0457])
tensor([101.2009,   3.0091,  39.1507,   3.8212,   5.1475,   7.5182,  32.3012,
         35.0839,   1.6544,   1.4746,   1.1124,   9.7696,  88.0368,  77.9080,
          9.4977,  10.5813,  11.4202,   0.9530,   0.6935,   3.1215,   1.0884,
          1.7153,   1.3366,   0.5971,   1.6596,   1.7849,   0.3785,   2.0836,
          1.2670,   1.7869,   1.4597,   1.7633])
tensor([2.2995, 2.1081, 2.3648, 1.3362, 1.8183, 1.3060, 0.8119, 1.6908, 2.5642,
        3.0446, 0.6321, 2.1565, 2.3138, 1.0462, 1.9045, 2.1485, 0.3267, 2.2342,
        1.2976, 1.7640, 2.1171, 2.6122, 1.3607, 1.1441, 2.0413, 1.1485, 1.0785,
        1.8160, 1.3603, 1.3085, 2.5379, 1.6335])
tensor([2.0473, 0.9899, 0.3702, 1.3680, 2.0031, 1.6296, 0.4149, 1.6536, 0.7690,
        1.8846, 1.7417, 0.9885, 0.6942, 2.6520, 0.6851, 1.3870, 0.9074, 2.0471,
        1.0763, 1.4366, 2.3153, 0.6569, 1.2559, 1.0868, 0.7112, 1.0420, 1.3834,
        1.2426, 1.1627, 1.6373, 1.2623, 1.0946])
tensor([1.1277, 3.2547, 1.3066, 2.1425, 1.4845, 2.0286, 1.7710, 2.6210, 0.5834,
        1.3838, 1.3659, 1.0842, 0.8454, 1.5239, 2.1263, 2.7938, 1.1597, 1.8536,
        1.4809, 1.0453, 1.6131, 0.9616, 1.7907, 2.0963, 0.8363, 0.1313, 1.2552,
        2.6176, 3.3169, 0.9542, 0.6622, 1.2455])
tensor([0.9635, 2.2767, 2.1864, 1.4981, 0.0593, 2.2318, 2.6336, 1.8114, 2.5235,
        2.0843, 1.5744, 0.9195, 3.2828, 1.3356, 0.4239, 0.6484, 1.5783, 0.6217,
        2.2783, 1.1738, 0.7524, 1.6400, 0.4848, 1.1484, 2.0387, 0.7545, 1.7639,
        2.5285, 1.9325, 0.0385, 1.1693, 0.6602])
tensor([2.2509, 0.7275, 1.0698, 0.9149, 1.8650, 1.4176, 1.0211, 1.6861, 1.6237,
        2.1444, 1.6880, 0.9437, 2.0135, 1.0426, 1.4953, 0.3369, 1.3841, 1.7618,
        1.7872, 0.5326, 3.0921, 1.6711, 1.5916, 0.6846, 1.4660, 1.1372, 1.4315,
        2.6840, 1.2566, 2.0639, 1.0983, 2.5201])
tensor([1.1694, 2.6556, 1.7032, 1.5781, 1.4159, 0.9517, 2.5772, 2.2222, 2.1363,
        3.0863, 0.3688, 1.4876, 1.6623, 2.0530, 1.3271, 2.1487, 1.0181, 0.6534,
        2.2778, 0.9635, 1.3127, 0.2119, 1.9036, 0.0226, 2.7261, 1.7074, 0.9662])
Test Accuracy: 0.7995</code></pre>
</div>
</div>
<div id="cell-40" class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># same here too.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>test_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data))</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        test_correct <span class="op">+=</span> torch.<span class="bu">sum</span>(preds <span class="op">==</span> labels.data)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>test_acc <span class="op">=</span> test_correct.double()<span class="op">/</span> <span class="bu">len</span>(test_dataset)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test Accuracy: </span><span class="sc">{</span>test_acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(test_dataset))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor(25)
tensor(23)
tensor(24)
tensor(24)
tensor(23)
tensor(30)
tensor(25)
tensor(28)
tensor(27)
tensor(25)
tensor(26)
tensor(23)
Test Accuracy: 0.7995
379</code></pre>
</div>
</div>
</section>
<section id="loss-curve-of-cnn-model." class="level2">
<h2 class="anchored" data-anchor-id="loss-curve-of-cnn-model.">Loss curve of CNN model.</h2>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Train Loss: <span class="fl">0.8324</span>, <span class="fl">0.5082</span>, <span class="fl">0.4658</span>, <span class="fl">0.4420</span>, <span class="fl">0.4376</span>, <span class="fl">0.4262</span>, <span class="fl">0.3820</span>, <span class="fl">0.3857</span>, <span class="fl">0.3818</span>, <span class="fl">0.3714</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Train Acc:  <span class="fl">0.7457</span>, <span class="fl">0.8062</span>, <span class="fl">0.8049</span>, <span class="fl">0.8111</span>, <span class="fl">0.8210</span>, <span class="fl">0.8160</span>, <span class="fl">0.8259</span>, <span class="fl">0.8272</span>, <span class="fl">0.8407</span>, <span class="fl">0.8469</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>Val Loss:   <span class="co">## I thought the model did not prerdict any 1 but when I look at a few more pictures and than I see it. It was just a coincidence.0.6008, 0.9038, 1.7440, 1.2597, 3.0783, 3.4121, 3.4937, 8.7321, 0.6095, 2.0479</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>Val Acc:    <span class="fl">0.8778</span>, <span class="fl">0.8667</span>, <span class="fl">0.8667</span>, <span class="fl">0.8889</span>, <span class="fl">0.8889</span>, <span class="fl">0.8778</span>, <span class="fl">0.8778</span>, <span class="fl">0.8778</span>, <span class="fl">0.8444</span>, <span class="fl">0.8556</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-43" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>train_loss_1 <span class="op">=</span> [<span class="fl">0.8324</span>, <span class="fl">0.5082</span>, <span class="fl">0.4658</span>, <span class="fl">0.4420</span>, <span class="fl">0.4376</span>, <span class="fl">0.4262</span>, <span class="fl">0.3820</span>, <span class="fl">0.3857</span>, <span class="fl">0.3818</span>, <span class="fl">0.3714</span>]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>train_acc_1 <span class="op">=</span>  [<span class="fl">0.7457</span>, <span class="fl">0.8062</span>, <span class="fl">0.8049</span>, <span class="fl">0.8111</span>, <span class="fl">0.8210</span>, <span class="fl">0.8160</span>, <span class="fl">0.8259</span>, <span class="fl">0.8272</span>, <span class="fl">0.8407</span>, <span class="fl">0.8469</span>]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>val_loss_1 <span class="op">=</span>   [<span class="fl">0.6008</span>, <span class="fl">0.9038</span>, <span class="fl">1.7440</span>, <span class="fl">1.2597</span>, <span class="fl">3.0783</span>, <span class="fl">3.4121</span>, <span class="fl">3.4937</span>, <span class="fl">8.7321</span>, <span class="fl">0.6095</span>, <span class="fl">2.0479</span>]</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>val_acc_1 <span class="op">=</span>    [<span class="fl">0.8778</span>, <span class="fl">0.8667</span>, <span class="fl">0.8667</span>, <span class="fl">0.8889</span>, <span class="fl">0.8889</span>, <span class="fl">0.8778</span>, <span class="fl">0.8778</span>, <span class="fl">0.8778</span>, <span class="fl">0.8444</span>, <span class="fl">0.8556</span>]</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>plt.plot(train_loss_1, label<span class="op">=</span><span class="st">'CNN Model Training Loss'</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>plt.plot(val_loss_1, label<span class="op">=</span><span class="st">'CNN Model Validation Loss'</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Loss'</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and Validation Loss Curve for CNN Model'</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="confusion-matrix-and-classification-report-of-cnn-model" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix-and-classification-report-of-cnn-model">Confusion matrix and Classification Report of CNN Model</h2>
<div id="cell-45" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation on the test set</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> []</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>test_labels <span class="op">=</span> []</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        test_predictions.extend(preds.cpu().numpy())</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        test_labels.extend(labels.cpu().numpy())</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> np.array(test_predictions)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>test_labels <span class="op">=</span> np.array(test_labels)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification Report:"</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_labels, test_predictions))</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate confusion matrix</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Confusion Matrix:"</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(test_labels, test_predictions)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classification Report:
              precision    recall  f1-score   support

           0       0.81      0.98      0.89       304
           1       0.46      0.08      0.14        75

    accuracy                           0.80       379
   macro avg       0.64      0.53      0.51       379
weighted avg       0.74      0.80      0.74       379

Confusion Matrix:
[[297   7]
 [ 69   6]]</code></pre>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display images</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_images(images, labels, predicted_labels, title):</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(images)), figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(title, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes.flat):</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(images):</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>            ax.imshow(images[i].permute(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>            ax.axis(<span class="st">'off'</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f"True: </span><span class="sc">{</span>labels[i]<span class="sc">}</span><span class="ch">\n</span><span class="ss">Pred: </span><span class="sc">{</span>predicted_labels[i]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>            ax.axis(<span class="st">'off'</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a batch of test images and labels</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>images, labels <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(test_loader))</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Move images to device</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> images.to(device)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get model predictions</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> model(images)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    _, preds <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices of correctly and incorrectly classified images</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>correct_indices <span class="op">=</span> (preds <span class="op">==</span> labels).nonzero().squeeze()</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>incorrect_indices <span class="op">=</span> (preds <span class="op">!=</span> labels).nonzero().squeeze()</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Select correctly classified images</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>num_correct <span class="op">=</span> <span class="bu">len</span>(correct_indices)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>correct_images <span class="op">=</span> images[correct_indices][:num_correct]</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>correct_labels <span class="op">=</span> labels[correct_indices][:num_correct]</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>correct_preds <span class="op">=</span> preds[correct_indices][:num_correct]</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Select incorrectly classified images</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>num_incorrect <span class="op">=</span> <span class="bu">len</span>(incorrect_indices)</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>incorrect_images <span class="op">=</span> images[incorrect_indices][:num_incorrect]</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>incorrect_labels <span class="op">=</span> labels[incorrect_indices][:num_incorrect]</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>incorrect_preds <span class="op">=</span> preds[incorrect_indices][:num_incorrect]</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the selected images</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>show_images(correct_images, correct_labels, correct_preds, <span class="st">"Correctly Classified Samples"</span>)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>show_images(incorrect_images, incorrect_labels, incorrect_preds, <span class="st">"Incorrectly Classified Samples"</span>)</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the images</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-23-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-23-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence.-and-also-i-look-to-the-confusion-matrix-and-it-shows-us-69-6-predictions-results-are-1." class="level2">
<h2 class="anchored" data-anchor-id="i-thought-the-model-did-not-prerdict-any-1-but-when-i-look-at-a-few-more-pictures-and-than-i-see-it.-it-was-just-a-coincidence.-and-also-i-look-to-the-confusion-matrix-and-it-shows-us-69-6-predictions-results-are-1.">^^ ^^ I thought the model did not prerdict any 1 but when I look at a few more pictures and than I see it. It was just a coincidence. And also I look to the confusion matrix and it shows us 69 + 6 predictions results are 1.</h2>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/fevzikilas\.github\.io\/skin_cancer_model_ISIC2016");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/fevzikilas/skin_cancer_model_ISIC2016/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>